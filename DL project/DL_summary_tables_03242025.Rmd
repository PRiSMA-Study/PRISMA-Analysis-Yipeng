---
title: "Summary Tables for ML/AI Project"
output:
  pdf_document: default
  html_document: default
date: "2025-01-10"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, out.width = "100%") 
knitr::opts_chunk$set(out.width = "75%", fig.align = "center")

library(tidyverse)
library(gt)
library(naniar)

data.static<-read.csv("D:/Users/yipeng_wei/Documents/dl data/2025-01-10/df_dl_static.csv")
data.temporal.wide<-read.csv("D:/Users/yipeng_wei/Documents/dl data/2025-01-10/df_dl_temporal_wide.csv")

#table format
tb_theme1 <- function(matrix){
  tb <- matrix %>%
    gt(
      rownames_to_stub = TRUE
    ) %>%
    opt_align_table_header(align = "left") %>%
    tab_spanner(
      label = "Sites"
    ) %>%
    opt_stylize(style = 6, color = 'gray') %>%
    tab_style(
      style = list(
        cell_fill(color = "#540B0E"),
        cell_text(weight = "bold"),
        cell_text(v_align = "middle"),
        cell_text(color = "white", size = px(18))
      ),
      locations = list(
        cells_title()
      ) 
    ) %>%
    tab_style(
      style = list(
        cell_fill(color = "#E09F3E"), # #f0b7b3,#f7cbc8, 
        cell_text( color = "black", size = px(18)),
        cell_text(v_align = "middle")
      ),
      locations = list(
        cells_stubhead(),
        cells_column_spanners(),
        cells_column_labels()
      )
    ) %>%
    tab_style(
      style = list(
        cell_fill(color = "#F0F0F0"),
        cell_text(v_align = "middle", size = px(18))
      ),
      locations = list(
        cells_stub()
      )
    ) %>%
    tab_style(
      style = list(
        cell_text(align = "center", size = px(18))
      ),
      locations = list(
        cells_column_labels(columns = everything())
      )
    ) %>%
    tab_style(
      style = list(
        cell_text(align = "center", size = px(18))
      ),
      locations = list(
        cells_body(columns = everything())
      )
    ) %>%
    fmt_markdown(columns = everything()) %>%
    tab_options(table.width = pct(100)) %>%
    cols_width(1 ~ px(250))
}

```
\setcounter{tocdepth}{6}
\tableofcontents

\newpage
# 1. Outcome Variables
```{r}
matrix_demo_a <- data.static %>% 
  group_by(SITE) %>% 
  summarise(
"Expected denominator, n^a^" = n(),

    "Observed denominator, n" = sum(!is.na(INF_ASPH)),
    "Birth asphyxia: n (%)" = 
      paste0(sum(INF_ASPH == 1, na.rm = TRUE), 
             " (", format(sum(INF_ASPH == 1, na.rm = TRUE)/sum(!is.na(INF_ASPH))*100, digits = 2, nsmall = 2), ")"),

    "Observed denominator, n " = sum(!is.na(STILLBIRTH_SIGNS_LIFE)),
    "Stillbirth: n (%)" = 
      paste0(sum(STILLBIRTH_SIGNS_LIFE == 1, na.rm = TRUE), 
             " (", format(sum(STILLBIRTH_SIGNS_LIFE == 1, na.rm = TRUE)/sum(!is.na(STILLBIRTH_SIGNS_LIFE))*100, digits = 2, nsmall = 2), ")"),

    "Observed denominator, n  " = sum(!is.na(PRETERMBIRTH_LT37)),
    "Preterm birth (37 weeks): n (%)" = 
      paste0(sum(PRETERMBIRTH_LT37 == 1, na.rm = TRUE), 
             " (", format(sum(PRETERMBIRTH_LT37 == 1, na.rm = TRUE)/sum(!is.na(PRETERMBIRTH_LT37))*100, digits = 2, nsmall = 2), ")"),

    "Observed denominator, n   " = sum(!is.na(INF_PSBI_IPC)),
    "PSBI at IPC: n (%)" = 
      paste0(sum(INF_PSBI_IPC == 1, na.rm = TRUE), 
             " (", format(sum(INF_PSBI_IPC == 1, na.rm = TRUE)/sum(!is.na(INF_PSBI_IPC))*100, digits = 2, nsmall = 2), ")"),

    "Observed denominator, n    " = sum(!is.na(INF_JAUN_NON_SEV_ANY)),
    "Non-severe Jaundice: n (%)" = 
      paste0(sum(INF_JAUN_NON_SEV_ANY == 1, na.rm = TRUE), 
             " (", format(sum(INF_JAUN_NON_SEV_ANY == 1, na.rm = TRUE)/sum(!is.na(INF_JAUN_NON_SEV_ANY))*100, digits = 2, nsmall = 2), ")"),
  ) %>% 
  t() %>% as.data.frame() %>% 
  `colnames<-`(c(.[1,])) %>% 
  slice(-1) %>% 
  add_column(
    .after = 6,
    "Total" = data.static %>% 
      summarise(
"Expected denominator, n^a^" = n(),

    "Observed denominator, n" = sum(!is.na(INF_ASPH)),
    "Birth asphyxia: n (%)" = 
      paste0(sum(INF_ASPH == 1, na.rm = TRUE), 
             " (", format(sum(INF_ASPH == 1, na.rm = TRUE)/sum(!is.na(INF_ASPH))*100, digits = 2, nsmall = 2), ")"),

    "Observed denominator, n " = sum(!is.na(STILLBIRTH_SIGNS_LIFE)),
    "Stillbirth: n (%)" = 
      paste0(sum(STILLBIRTH_SIGNS_LIFE == 1, na.rm = TRUE), 
             " (", format(sum(STILLBIRTH_SIGNS_LIFE == 1, na.rm = TRUE)/sum(!is.na(STILLBIRTH_SIGNS_LIFE))*100, digits = 2, nsmall = 2), ")"),

    "Observed denominator, n  " = sum(!is.na(PRETERMBIRTH_LT37)),
    "Preterm birth (37 weeks): n (%)" = 
      paste0(sum(PRETERMBIRTH_LT37 == 1, na.rm = TRUE), 
             " (", format(sum(PRETERMBIRTH_LT37 == 1, na.rm = TRUE)/sum(!is.na(PRETERMBIRTH_LT37))*100, digits = 2, nsmall = 2), ")"),

    "Observed denominator, n   " = sum(!is.na(INF_PSBI_IPC)),
    "PSBI at IPC: n (%)" = 
      paste0(sum(INF_PSBI_IPC == 1, na.rm = TRUE), 
             " (", format(sum(INF_PSBI_IPC == 1, na.rm = TRUE)/sum(!is.na(INF_PSBI_IPC))*100, digits = 2, nsmall = 2), ")"),

    "Observed denominator, n    " = sum(!is.na(INF_JAUN_NON_SEV_ANY)),
    "Non-severe Jaundice: n (%)" = 
      paste0(sum(INF_JAUN_NON_SEV_ANY == 1, na.rm = TRUE), 
             " (", format(sum(INF_JAUN_NON_SEV_ANY == 1, na.rm = TRUE)/sum(!is.na(INF_JAUN_NON_SEV_ANY))*100, digits = 2, nsmall = 2), ")"),
      ) %>% 
      t() %>% unlist()
  )

tb_demo_a <- tb_theme1(matrix_demo_a) %>% 
  tab_header(
    title = md("**Table 1: Outcome Variable**")
  ) %>% 
  tab_row_group(
    label = "Birth asphyxia",
    rows = 2:3  
  ) %>% 
  tab_row_group(
    label = "Stillbirth",
    rows = 4:5  
  ) %>% 
  tab_row_group(
    label = "Preterm birth (37 weeks)",
    rows = 6:7  
  ) %>% 
  tab_row_group(
    label = "PSBI at IPC",
    rows = 8:9  
  ) %>% 
  tab_row_group(
    label = "Non-severe Jaundice",
    rows = 10:11  
  ) %>% 

  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(rows = c(
      "Observed denominator, n",
      "Observed denominator, n ",
      "Observed denominator, n  ",
      "Observed denominator, n   ",
      "Observed denominator, n    "
    )))  %>%
  row_group_order(groups = c(NA, 
    "Birth asphyxia", 
    "Stillbirth", 
    "Preterm birth (37 weeks)", 
    "PSBI at IPC", 
    "Non-severe Jaundice" 
  )) %>% 
  tab_footnote(
    footnote = html("<sup>a</sup> Expected denominator is PRiSMA cohort; observed denominator are those with non-missing results.")
  )  %>%
  gtsave("Outcome_summary.png", expand = 10)

knitr::include_graphics("Outcome_summary.png")
```
# 2. Risk factors
## 2.1 Medical History
```{r}
matrix_demo_a <- data.static %>% 
  group_by(SITE) %>% 
  summarise(
"Expected denominator, n^a^" = n(),

    "Observed denominator, n" = sum(!is.na(ASPHYXIA_IND)),
    "Birth asphyxia: n (%)" = 
      paste0(sum(ASPHYXIA_IND == 1, na.rm = TRUE), 
             " (", format(sum(ASPHYXIA_IND == 1, na.rm = TRUE)/sum(!is.na(ASPHYXIA_IND))*100, digits = 2, nsmall = 2), ")"),

    "Observed denominator, n " = sum(!is.na(STILLBIRTH_IND)),
    "Stillbirth: n (%)" = 
      paste0(sum(STILLBIRTH_IND == 1, na.rm = TRUE), 
             " (", format(sum(STILLBIRTH_IND == 1, na.rm = TRUE)/sum(!is.na(STILLBIRTH_IND))*100, digits = 2, nsmall = 2), ")"),

    "Observed denominator, n  " = sum(!is.na(PRETERM_IND)),
    "Preterm birth: n (%)" = 
      paste0(sum(PRETERM_IND == 1, na.rm = TRUE), 
             " (", format(sum(PRETERM_IND == 1, na.rm = TRUE)/sum(!is.na(PRETERM_IND))*100, digits = 2, nsmall = 2), ")"),

    "Observed denominator, n   " = sum(!is.na(POSTTERM_IND)),
    "Postterm birth: n (%)" = 
      paste0(sum(POSTTERM_IND == 1, na.rm = TRUE), 
             " (", format(sum(POSTTERM_IND == 1, na.rm = TRUE)/sum(!is.na(POSTTERM_IND))*100, digits = 2, nsmall = 2), ")"),

    "Observed denominator, n    " = sum(!is.na(GEST_HTN_IND)),
    "Gestational hypertension: n (%)" = 
      paste0(sum(GEST_HTN_IND == 1, na.rm = TRUE), 
             " (", format(sum(GEST_HTN_IND == 1, na.rm = TRUE)/sum(!is.na(GEST_HTN_IND))*100, digits = 2, nsmall = 2), ")"),

    "Observed denominator, n     " = sum(!is.na(PREECLAMPSIA_IND)),
    "Preeclampsia: n (%)" = 
      paste0(sum(PREECLAMPSIA_IND == 1, na.rm = TRUE), 
             " (", format(sum(PREECLAMPSIA_IND == 1, na.rm = TRUE)/sum(!is.na(PREECLAMPSIA_IND))*100, digits = 2, nsmall = 2), ")"),

    "Observed denominator, n      " = sum(!is.na(GEST_DIAB_IND)),
    "Gestational diabetes: n (%)" = 
      paste0(sum(GEST_DIAB_IND == 1, na.rm = TRUE), 
             " (", format(sum(GEST_DIAB_IND == 1, na.rm = TRUE)/sum(!is.na(GEST_DIAB_IND))*100, digits = 2, nsmall = 2), ")"),

    "Observed denominator, n       " = sum(!is.na(PREMATURE_RUPTURE_IND)),
    "Premature rupture of membranes: n (%)" = 
      paste0(sum(PREMATURE_RUPTURE_IND == 1, na.rm = TRUE), 
             " (", format(sum(PREMATURE_RUPTURE_IND == 1, na.rm = TRUE)/sum(!is.na(PREMATURE_RUPTURE_IND))*100, digits = 2, nsmall = 2), ")"),

    "Observed denominator, n        " = sum(!is.na(OBSTR_LABOR_IND)),
    "Obstructed or prolonged labor: n (%)" = 
      paste0(sum(OBSTR_LABOR_IND == 1, na.rm = TRUE), 
             " (", format(sum(OBSTR_LABOR_IND == 1, na.rm = TRUE)/sum(!is.na(OBSTR_LABOR_IND))*100, digits = 2, nsmall = 2), ")")
  ) %>% 
  t() %>% as.data.frame() %>% 
  `colnames<-`(c(.[1,])) %>% 
  slice(-1) %>% 
  add_column(
    .after = 6,
    "Total" = data.static %>% 
      summarise(
"Expected denominator, n^a^" = n(),

    "Observed denominator, n" = sum(!is.na(ASPHYXIA_IND)),
    "Birth asphyxia: n (%)" = 
      paste0(sum(ASPHYXIA_IND == 1, na.rm = TRUE), 
             " (", format(sum(ASPHYXIA_IND == 1, na.rm = TRUE)/sum(!is.na(ASPHYXIA_IND))*100, digits = 2, nsmall = 2), ")"),

    "Observed denominator, n " = sum(!is.na(STILLBIRTH_IND)),
    "Stillbirth: n (%)" = 
      paste0(sum(STILLBIRTH_IND == 1, na.rm = TRUE), 
             " (", format(sum(STILLBIRTH_IND == 1, na.rm = TRUE)/sum(!is.na(STILLBIRTH_IND))*100, digits = 2, nsmall = 2), ")"),

    "Observed denominator, n  " = sum(!is.na(PRETERM_IND)),
    "Preterm birth: n (%)" = 
      paste0(sum(PRETERM_IND == 1, na.rm = TRUE), 
             " (", format(sum(PRETERM_IND == 1, na.rm = TRUE)/sum(!is.na(PRETERM_IND))*100, digits = 2, nsmall = 2), ")"),

    "Observed denominator, n   " = sum(!is.na(POSTTERM_IND)),
    "Postterm birth: n (%)" = 
      paste0(sum(POSTTERM_IND == 1, na.rm = TRUE), 
             " (", format(sum(POSTTERM_IND == 1, na.rm = TRUE)/sum(!is.na(POSTTERM_IND))*100, digits = 2, nsmall = 2), ")"),

    "Observed denominator, n    " = sum(!is.na(GEST_HTN_IND)),
    "Gestational hypertension: n (%)" = 
      paste0(sum(GEST_HTN_IND == 1, na.rm = TRUE), 
             " (", format(sum(GEST_HTN_IND == 1, na.rm = TRUE)/sum(!is.na(GEST_HTN_IND))*100, digits = 2, nsmall = 2), ")"),

    "Observed denominator, n     " = sum(!is.na(PREECLAMPSIA_IND)),
    "Preeclampsia: n (%)" = 
      paste0(sum(PREECLAMPSIA_IND == 1, na.rm = TRUE), 
             " (", format(sum(PREECLAMPSIA_IND == 1, na.rm = TRUE)/sum(!is.na(PREECLAMPSIA_IND))*100, digits = 2, nsmall = 2), ")"),

    "Observed denominator, n      " = sum(!is.na(GEST_DIAB_IND)),
    "Gestational diabetes: n (%)" = 
      paste0(sum(GEST_DIAB_IND == 1, na.rm = TRUE), 
             " (", format(sum(GEST_DIAB_IND == 1, na.rm = TRUE)/sum(!is.na(GEST_DIAB_IND))*100, digits = 2, nsmall = 2), ")"),

    "Observed denominator, n       " = sum(!is.na(PREMATURE_RUPTURE_IND)),
    "Premature rupture of membranes: n (%)" = 
      paste0(sum(PREMATURE_RUPTURE_IND == 1, na.rm = TRUE), 
             " (", format(sum(PREMATURE_RUPTURE_IND == 1, na.rm = TRUE)/sum(!is.na(PREMATURE_RUPTURE_IND))*100, digits = 2, nsmall = 2), ")"),

    "Observed denominator, n        " = sum(!is.na(OBSTR_LABOR_IND)),
    "Obstructed or prolonged labor: n (%)" = 
      paste0(sum(OBSTR_LABOR_IND == 1, na.rm = TRUE), 
             " (", format(sum(OBSTR_LABOR_IND == 1, na.rm = TRUE)/sum(!is.na(OBSTR_LABOR_IND))*100, digits = 2, nsmall = 2), ")")
      ) %>% 
      t() %>% unlist()
  )

tb_demo_a <- tb_theme1(matrix_demo_a) %>% 
  tab_header(
    title = md("**Table 2.1: Medical History**")
  ) %>% 
  tab_row_group(
    label = "Birth asphyxia",
    rows = 2:3  
  ) %>% 
  tab_row_group(
    label = "Stillbirth",
    rows = 4:5  
  ) %>% 
  tab_row_group(
    label = "Preterm birth",
    rows = 6:7  
  ) %>% 
  tab_row_group(
    label = "Postterm birth",
    rows = 8:9  
  ) %>% 
  tab_row_group(
    label = "Gestational hypertension",
    rows = 10:11  
  ) %>% 
  tab_row_group(
    label = "Preeclampsia",
    rows = 12:13  
  ) %>% 
  tab_row_group(
    label = "Gestational diabetes",
    rows = 14:15  
  ) %>% 
  tab_row_group(
    label = "Premature rupture of membranes",
    rows = 16:17  
  ) %>% 
  tab_row_group(
    label = "Obstructed or prolonged labor",
    rows = 18:19  
  ) %>%   
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(rows = c(
      "Observed denominator, n",
      "Observed denominator, n ",
      "Observed denominator, n  ",
      "Observed denominator, n   ",
      "Observed denominator, n    ",
      "Observed denominator, n     ",
      "Observed denominator, n      ",
      "Observed denominator, n       ",
      "Observed denominator, n        "
    )))  %>%
  row_group_order(groups = c(NA, 
    "Birth asphyxia", 
    "Stillbirth", 
    "Preterm birth", 
    "Postterm birth", 
    "Gestational hypertension", 
    "Preeclampsia", 
    "Gestational diabetes", 
    "Premature rupture of membranes", 
    "Obstructed or prolonged labor"
  )) %>% 
  tab_footnote(
    footnote = html("<sup>a</sup> Expected denominator is PRiSMA cohort; observed denominator are those with non-missing results.")
  )  %>%
  gtsave("Medical_History_summary.png", expand = 10)

knitr::include_graphics("Medical_History_summary.png")
```
## 2.2 Infection
```{r}
matrix_demo_a<- data.static %>% 
  group_by(SITE) %>% 
  summarise(
    "Expected denominator, n^a^" = n(),
    # HIV
    "Observed denominator for HIV, n" = paste0(
      format(sum(HIV_POSITIVE_ENROLL < 55 & HIV_MISSING_ENROLL == 0, na.rm = TRUE), nsmall = 0, digits = 2)),
    
    "Positive for HIV: n (%)" = 
      paste0(sum(HIV_POSITIVE_ENROLL == 1, na.rm = TRUE), 
             " (", format(sum(HIV_POSITIVE_ENROLL == 1, na.rm = TRUE) / 
                            sum(HIV_POSITIVE_ENROLL < 55 & HIV_MISSING_ENROLL == 0, na.rm = TRUE) * 100, digits = 2, nsmall = 0), ")"),
    
    # Syphilis
    "Observed denominator for Syphilis, n" = paste0(
      format(sum(SYPH_POSITIVE_ENROLL < 55 & SYPH_MISSING_ENROLL == 0, na.rm = TRUE), nsmall = 0, digits = 2)),
    
    "Positive for Syphilis: n (%)" = 
      paste0(sum(SYPH_POSITIVE_ENROLL == 1, na.rm = TRUE), 
             " (", format(sum(SYPH_POSITIVE_ENROLL == 1, na.rm = TRUE) / 
                            sum(SYPH_POSITIVE_ENROLL < 55 & SYPH_MISSING_ENROLL == 0, na.rm = TRUE) * 100, digits = 2, nsmall = 0), ")"),
    
    # Gonorrhea
    "Observed denominator for Gonorrhea, n" = paste0(
      format(sum(GON_POSITIVE_ENROLL < 55 & GON_DIAG_MISSING_ENROLL == 0, na.rm = TRUE), nsmall = 0, digits = 2)),
    
    "Positive for Gonorrhea: n (%)" = 
      paste0(sum(GON_POSITIVE_ENROLL == 1, na.rm = TRUE), 
             " (", format(sum(GON_POSITIVE_ENROLL == 1, na.rm = TRUE) / 
                            sum(GON_POSITIVE_ENROLL < 55 & GON_DIAG_MISSING_ENROLL == 0, na.rm = TRUE) * 100, digits = 2, nsmall = 0), ")"),
    
    # Chlamydia
    "Observed denominator for Chlamydia, n" = paste0(
      format(sum(CHL_POSITIVE_ENROLL < 55 & CHL_DIAG_MISSING_ENROLL == 0, na.rm = TRUE), nsmall = 0, digits = 2)),
    
    "Positive for Chlamydia: n (%)" = 
      paste0(sum(CHL_POSITIVE_ENROLL == 1, na.rm = TRUE), 
             " (", format(sum(CHL_POSITIVE_ENROLL == 1, na.rm = TRUE) / 
                            sum(CHL_POSITIVE_ENROLL < 55 & CHL_DIAG_MISSING_ENROLL == 0, na.rm = TRUE) * 100, digits = 2, nsmall = 0), ")"),
    # Genital ulcers
    "Observed denominator for Genital ulcers, n" = paste0(
      format(sum(GENU_POSITIVE_ENROLL < 55 & GENU_DIAG_MISSING_ENROLL == 0, na.rm = TRUE), nsmall = 0, digits = 2)),
    
    "Positive for Genital ulcers: n (%)" = 
      paste0(sum(GENU_POSITIVE_ENROLL == 1, na.rm = TRUE), 
             " (", format(sum(GENU_POSITIVE_ENROLL == 1, na.rm = TRUE) / 
                            sum(GENU_POSITIVE_ENROLL < 55 & GENU_DIAG_MISSING_ENROLL == 0, na.rm = TRUE) * 100, digits = 2, nsmall = 0), ")"),
    # Malaria
    "Observed denominator for Malaria, n" = paste0(
      format(sum(MAL_POSITIVE_ENROLL < 55 & MAL_MISSING_ENROLL == 0, na.rm = TRUE), nsmall = 0, digits = 2)),
    
    "Positive for Malaria: n (%)" = 
      paste0(sum(MAL_POSITIVE_ENROLL == 1, na.rm = TRUE), 
             " (", format(sum(MAL_POSITIVE_ENROLL == 1, na.rm = TRUE) / 
                            sum(MAL_POSITIVE_ENROLL < 55 & MAL_MISSING_ENROLL == 0, na.rm = TRUE) * 100, digits = 2, nsmall = 0), ")"),
    
    # HBV
    "Observed denominator for HBV, n" = paste0(
      format(sum(HBV_POSITIVE_ENROLL < 55 & HBV_MEAS_MISSING_ENROLL == 0, na.rm = TRUE), nsmall = 0, digits = 2)),
    
    "Positive for HBV: n (%)" = 
      paste0(sum(HBV_POSITIVE_ENROLL == 1, na.rm = TRUE), 
             " (", format(sum(HBV_POSITIVE_ENROLL == 1, na.rm = TRUE) / 
                            sum(HBV_POSITIVE_ENROLL < 55 & HBV_MEAS_MISSING_ENROLL == 0, na.rm = TRUE) * 100, digits = 2, nsmall = 0), ")"),
    
    # HCV
    "Observed denominator for HCV, n" = paste0(
      format(sum(HCV_POSITIVE_ENROLL < 55 & HCV_MEAS_MISSING_ENROLL == 0, na.rm = TRUE), nsmall = 0, digits = 2)),
    
    "Positive for HCV: n (%)" = 
      paste0(sum(HCV_POSITIVE_ENROLL == 1, na.rm = TRUE), 
             " (", format(sum(HCV_POSITIVE_ENROLL == 1, na.rm = TRUE) / 
                            sum(HCV_POSITIVE_ENROLL < 55 & HCV_MEAS_MISSING_ENROLL == 0, na.rm = TRUE) * 100, digits = 2, nsmall = 0), ")"),
    "Observed denominator for Other STIs, n" = paste0(
      format(sum(OTHR_POSITIVE_ENROLL < 55 & OTHR_DIAG_MISSING_ENROLL == 0, na.rm = TRUE), nsmall = 0, digits = 2)),
    
    "Positive for Other STIs: n (%)" = 
      paste0(sum(OTHR_POSITIVE_ENROLL == 1, na.rm = TRUE), 
             " (", format(sum(OTHR_POSITIVE_ENROLL == 1, na.rm = TRUE) / 
                            sum(OTHR_POSITIVE_ENROLL < 55 & OTHR_DIAG_MISSING_ENROLL == 0, na.rm = TRUE) * 100, digits = 2, nsmall = 0), ")")
  ) %>% 
  t() %>% as.data.frame() %>% 
  `colnames<-`(c(.[1,])) %>% 
  slice(-1) %>% add_column(
    .after = 6,
    "Total" = data.static %>% 
      summarise(
        "Expected denominator, n^a^" = n(),
        # HIV
        "Observed denominator for HIV, n" = paste0(
          format(sum(HIV_POSITIVE_ENROLL < 55 & HIV_MISSING_ENROLL == 0, na.rm = TRUE), nsmall = 0, digits = 2)),
        
        "Positive for HIV: n (%)" = 
          paste0(sum(HIV_POSITIVE_ENROLL == 1, na.rm = TRUE), 
                 " (", format(sum(HIV_POSITIVE_ENROLL == 1, na.rm = TRUE) / 
                                sum(HIV_POSITIVE_ENROLL < 55 & HIV_MISSING_ENROLL == 0, na.rm = TRUE) * 100, digits = 2, nsmall = 0), ")"),
        
        # Syphilis
        "Observed denominator for Syphilis, n" = paste0(
          format(sum(SYPH_POSITIVE_ENROLL < 55 & SYPH_MISSING_ENROLL == 0, na.rm = TRUE), nsmall = 0, digits = 2)),
        
        "Positive for Syphilis: n (%)" = 
          paste0(sum(SYPH_POSITIVE_ENROLL == 1, na.rm = TRUE), 
                 " (", format(sum(SYPH_POSITIVE_ENROLL == 1, na.rm = TRUE) / 
                                sum(SYPH_POSITIVE_ENROLL < 55 & SYPH_MISSING_ENROLL == 0, na.rm = TRUE) * 100, digits = 2, nsmall = 0), ")"),
        
        # Gonorrhea
        "Observed denominator for Gonorrhea, n" = paste0(
          format(sum(GON_POSITIVE_ENROLL < 55 & GON_DIAG_MISSING_ENROLL == 0, na.rm = TRUE), nsmall = 0, digits = 2)),
        
        "Positive for Gonorrhea: n (%)" = 
          paste0(sum(GON_POSITIVE_ENROLL == 1, na.rm = TRUE), 
                 " (", format(sum(GON_POSITIVE_ENROLL == 1, na.rm = TRUE) / 
                                sum(GON_POSITIVE_ENROLL < 55 & GON_DIAG_MISSING_ENROLL == 0, na.rm = TRUE) * 100, digits = 2, nsmall = 0), ")"),
        
        # Chlamydia
        "Observed denominator for Chlamydia, n" = paste0(
          format(sum(CHL_POSITIVE_ENROLL < 55 & CHL_DIAG_MISSING_ENROLL == 0, na.rm = TRUE), nsmall = 0, digits = 2)),
        
        "Positive for Chlamydia: n (%)" = 
          paste0(sum(CHL_POSITIVE_ENROLL == 1, na.rm = TRUE), 
                 " (", format(sum(CHL_POSITIVE_ENROLL == 1, na.rm = TRUE) / 
                                sum(CHL_POSITIVE_ENROLL < 55 & CHL_DIAG_MISSING_ENROLL == 0, na.rm = TRUE) * 100, digits = 2, nsmall = 0), ")"),
        # Genital ulcers
        "Observed denominator for Genital ulcers, n" = paste0(
          format(sum(GENU_POSITIVE_ENROLL < 55 & GENU_DIAG_MISSING_ENROLL == 0, na.rm = TRUE), nsmall = 0, digits = 2)),
        
        "Positive for Genital ulcers: n (%)" = 
          paste0(sum(GENU_POSITIVE_ENROLL == 1, na.rm = TRUE), 
                 " (", format(sum(GENU_POSITIVE_ENROLL == 1, na.rm = TRUE) / 
                                sum(GENU_POSITIVE_ENROLL < 55 & GENU_DIAG_MISSING_ENROLL == 0, na.rm = TRUE) * 100, digits = 2, nsmall = 0), ")"),
        # Malaria
        "Observed denominator for Malaria, n" = paste0(
          format(sum(MAL_POSITIVE_ENROLL < 55 & MAL_MISSING_ENROLL == 0, na.rm = TRUE), nsmall = 0, digits = 2)),
        
        "Positive for Malaria: n (%)" = 
          paste0(sum(MAL_POSITIVE_ENROLL == 1, na.rm = TRUE), 
                 " (", format(sum(MAL_POSITIVE_ENROLL == 1, na.rm = TRUE) / 
                                sum(MAL_POSITIVE_ENROLL < 55 & MAL_MISSING_ENROLL == 0, na.rm = TRUE) * 100, digits = 2, nsmall = 0), ")"),
        
        # HBV
        "Observed denominator for HBV, n" = paste0(
          format(sum(HBV_POSITIVE_ENROLL < 55 & HBV_MEAS_MISSING_ENROLL == 0, na.rm = TRUE), nsmall = 0, digits = 2)),
        
        "Positive for HBV: n (%)" = 
          paste0(sum(HBV_POSITIVE_ENROLL == 1, na.rm = TRUE), 
                 " (", format(sum(HBV_POSITIVE_ENROLL == 1, na.rm = TRUE) / 
                                sum(HBV_POSITIVE_ENROLL < 55 & HBV_MEAS_MISSING_ENROLL == 0, na.rm = TRUE) * 100, digits = 2, nsmall = 0), ")"),
        
        # HCV
        "Observed denominator for HCV, n" = paste0(
          format(sum(HCV_POSITIVE_ENROLL < 55 & HCV_MEAS_MISSING_ENROLL == 0, na.rm = TRUE), nsmall = 0, digits = 2)),
        
        "Positive for HCV: n (%)" = 
          paste0(sum(HCV_POSITIVE_ENROLL == 1, na.rm = TRUE), 
                 " (", format(sum(HCV_POSITIVE_ENROLL == 1, na.rm = TRUE) / 
                                sum(HCV_POSITIVE_ENROLL < 55 & HCV_MEAS_MISSING_ENROLL == 0, na.rm = TRUE) * 100, digits = 2, nsmall = 0), ")"),
        "Observed denominator for Other STIs, n" = paste0(
          format(sum(OTHR_POSITIVE_ENROLL < 55 & OTHR_DIAG_MISSING_ENROLL == 0, na.rm = TRUE), nsmall = 0, digits = 2)),
        
        "Positive for Other STIs: n (%)" = 
          paste0(sum(OTHR_POSITIVE_ENROLL == 1, na.rm = TRUE), 
                 " (", format(sum(OTHR_POSITIVE_ENROLL == 1, na.rm = TRUE) / 
                                sum(OTHR_POSITIVE_ENROLL < 55 & OTHR_DIAG_MISSING_ENROLL == 0, na.rm = TRUE) * 100, digits = 2, nsmall = 0), ")")
      ) %>% 
      t() %>% unlist()
  )
tb_demo_a <- tb_theme1(matrix_demo_a) %>% 
  tab_header(
    title = md("**Table 2.2: Infection**")
  ) %>% 
  
  # Grouping Infections
  tab_row_group(label = "HIV", rows = 2:3) %>% 
  tab_row_group(label = "Syphilis", rows = 4:5) %>% 
  tab_row_group(label = "Gonorrhea", rows = 6:7) %>% 
  tab_row_group(label = "Chlamydia", rows = 8:9) %>% 
  tab_row_group(label = "Genital Ulcers", rows = 10:11) %>% 
  tab_row_group(label = "Malaria", rows = 12:13) %>% 
  tab_row_group(label = "Hepatitis B", rows = 14:15) %>% 
  tab_row_group(label = "Hepatitis C", rows = 16:17) %>%  
  tab_row_group(label = "Other STIs", rows = 18:19) %>% 

  # Bold the observed denominator rows
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(rows = c(
      "Observed denominator for HIV, n",
      "Observed denominator for Syphilis, n",
      "Observed denominator for Gonorrhea, n",
      "Observed denominator for Chlamydia, n",
      "Observed denominator for Genital ulcers, n",
      "Observed denominator for Malaria, n",
      "Observed denominator for HBV, n",
      "Observed denominator for HCV, n",
      "Observed denominator for Other STIs, n"
    )))  %>%

  # Set the order of row groups
  row_group_order(groups = c(NA, 
    "HIV", 
    "Syphilis", 
    "Gonorrhea", 
    "Chlamydia", 
    "Genital Ulcers", 
    "Malaria",
    "Hepatitis B",
    "Hepatitis C",
    "Other STIs"
  )) %>% 

  # Add footnotes for clarity
  tab_footnote(
    footnote = html("<sup>a</sup> Expected denominator is PRiSMA cohort; observed denominator are those with non-missing results.")
  )  %>%
  tab_footnote(
    footnote = html("All infections were diagnosed at enrollment")
  )  %>%
  # Save table as an image
  gtsave("Infection_Summary.png", expand = 10)

# Display Image in RMarkdown
knitr::include_graphics("Infection_Summary.png")

```
## 2.3 Pregnancy & Labor
```{r}
matrix_demo_a <- data.static %>% 
  group_by(SITE) %>% 
  summarise(
"Expected denominator, n^a^" = n(),

    # Fetal Presentation
    "Observed denominator for fetal presentation, n" = sum(!is.na(INF_PRES_CEPH)),
    "Cephalic: n (%)" = 
      paste0(sum(INF_PRES_CEPH == 1, na.rm = TRUE), 
             " (", format(sum(INF_PRES_CEPH == 1, na.rm = TRUE) / sum(!is.na(INF_PRES_CEPH)) * 100, digits = 2, nsmall = 2), ")"),
    "Breech: n (%)" = 
      paste0(sum(INF_PRES_BREECH == 1, na.rm = TRUE), 
             " (", format(sum(INF_PRES_BREECH == 1, na.rm = TRUE) / sum(!is.na(INF_PRES_BREECH)) * 100, digits = 2, nsmall = 2), ")"),

    "Transverse lie: n (%)" = 
      paste0(sum(INF_PRES_TRANS == 1, na.rm = TRUE), 
             " (", format(sum(INF_PRES_TRANS == 1, na.rm = TRUE) / sum(!is.na(INF_PRES_TRANS)) * 100, digits = 2, nsmall = 2), ")"),

    "Brow or face: n (%)" = 
      paste0(sum(INF_PRES_BROW == 1, na.rm = TRUE), 
             " (", format(sum(INF_PRES_BROW == 1, na.rm = TRUE) / sum(!is.na(INF_PRES_BROW)) * 100, digits = 2, nsmall = 2), ")"),

    "Other: n (%)" = 
      paste0(sum(INF_PRES_OTHER == 1, na.rm = TRUE), 
             " (", format(sum(INF_PRES_OTHER == 1, na.rm = TRUE) / sum(!is.na(INF_PRES_OTHER)) * 100, digits = 2, nsmall = 2), ")"),

    # Membrane Status
    "Observed denominator for membrane status, n" = sum(!is.na(MEM_SPON)),
    "Spontaneous: n (%)" = 
      paste0(sum(MEM_SPON == 1, na.rm = TRUE), 
             " (", format(sum(MEM_SPON == 1, na.rm = TRUE) / sum(!is.na(MEM_SPON)) * 100, digits = 2, nsmall = 2), ")"),

    "Artificial: n (%)" = 
      paste0(sum(MEM_ART == 1, na.rm = TRUE), 
             " (", format(sum(MEM_ART == 1, na.rm = TRUE) / sum(!is.na(MEM_ART)) * 100, digits = 2, nsmall = 2), ")"),

    "Not applicable: n (%)" = 
      paste0(sum(MEM_CES == 1, na.rm = TRUE), 
             " (", format(sum(MEM_CES == 1, na.rm = TRUE) / sum(!is.na(MEM_CES)) * 100, digits = 2, nsmall = 2), ")"),

    # Pregnancy Outcome
    "Observed denominator for Preterm pregnancy endpoint (<37 weeks), n" = sum(!is.na(MAT_PRETERM_ANY)),
    "Preterm pregnancy endpoint (<37 weeks): n (%)" = 
      paste0(sum(MAT_PRETERM_ANY == 1, na.rm = TRUE), 
             " (", format(sum(MAT_PRETERM_ANY == 1, na.rm = TRUE) / sum(!is.na(MAT_PRETERM_ANY)) * 100, digits = 2, nsmall = 2), ")"),

    # Labor and Delivery
    "Observed denominator for Experienced any labor, n" = sum(!is.na(LABOR_ANY)),
    "Experienced any labor: n (%)" = 
      paste0(sum(LABOR_ANY == 1, na.rm = TRUE), 
             " (", format(sum(LABOR_ANY == 1, na.rm = TRUE) / sum(!is.na(LABOR_ANY)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for Prolonged labor, n" = sum(!is.na(PRO_LABOR)),
    "Prolonged labor: n (%)" = 
      paste0(sum(PRO_LABOR == 1, na.rm = TRUE), 
             " (", format(sum(PRO_LABOR == 1, na.rm = TRUE) / sum(!is.na(PRO_LABOR)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for Obstructed labor, n" = sum(!is.na(OBS_LABOR)),
    "Obstructed labor: n (%)" = 
      paste0(sum(OBS_LABOR == 1, na.rm = TRUE), 
             " (", format(sum(OBS_LABOR == 1, na.rm = TRUE) / sum(!is.na(OBS_LABOR)) * 100, digits = 2, nsmall = 2), ")"),

    # Hemorrhage
    "Observed denominator for Antepartum hemorrhage during ANC, n" = sum(!is.na(HEM_APH)),
    "Antepartum hemorrhage during ANC: n (%)" = 
      paste0(sum(HEM_APH == 1, na.rm = TRUE), 
             " (", format(sum(HEM_APH == 1, na.rm = TRUE) / sum(!is.na(HEM_APH)) * 100, digits = 2, nsmall = 2), ")")
     ) %>% 
  t() %>% as.data.frame() %>% 
  `colnames<-`(c(.[1,])) %>% 
  slice(-1) %>% 
  add_column(
    .after = 6,
    "Total" = data.static %>% 
      summarise(
"Expected denominator, n^a^" = n(),

    # Fetal Presentation
    "Observed denominator for fetal presentation, n" = sum(!is.na(INF_PRES_CEPH)),
    "Cephalic: n (%)" = 
      paste0(sum(INF_PRES_CEPH == 1, na.rm = TRUE), 
             " (", format(sum(INF_PRES_CEPH == 1, na.rm = TRUE) / sum(!is.na(INF_PRES_CEPH)) * 100, digits = 2, nsmall = 2), ")"),
    "Breech: n (%)" = 
      paste0(sum(INF_PRES_BREECH == 1, na.rm = TRUE), 
             " (", format(sum(INF_PRES_BREECH == 1, na.rm = TRUE) / sum(!is.na(INF_PRES_BREECH)) * 100, digits = 2, nsmall = 2), ")"),

    "Transverse lie: n (%)" = 
      paste0(sum(INF_PRES_TRANS == 1, na.rm = TRUE), 
             " (", format(sum(INF_PRES_TRANS == 1, na.rm = TRUE) / sum(!is.na(INF_PRES_TRANS)) * 100, digits = 2, nsmall = 2), ")"),

    "Brow or face: n (%)" = 
      paste0(sum(INF_PRES_BROW == 1, na.rm = TRUE), 
             " (", format(sum(INF_PRES_BROW == 1, na.rm = TRUE) / sum(!is.na(INF_PRES_BROW)) * 100, digits = 2, nsmall = 2), ")"),

    "Other: n (%)" = 
      paste0(sum(INF_PRES_OTHER == 1, na.rm = TRUE), 
             " (", format(sum(INF_PRES_OTHER == 1, na.rm = TRUE) / sum(!is.na(INF_PRES_OTHER)) * 100, digits = 2, nsmall = 2), ")"),

    # Membrane Status
    "Observed denominator for membrane status, n" = sum(!is.na(MEM_SPON)),
    "Spontaneous: n (%)" = 
      paste0(sum(MEM_SPON == 1, na.rm = TRUE), 
             " (", format(sum(MEM_SPON == 1, na.rm = TRUE) / sum(!is.na(MEM_SPON)) * 100, digits = 2, nsmall = 2), ")"),

    "Artificial: n (%)" = 
      paste0(sum(MEM_ART == 1, na.rm = TRUE), 
             " (", format(sum(MEM_ART == 1, na.rm = TRUE) / sum(!is.na(MEM_ART)) * 100, digits = 2, nsmall = 2), ")"),

    "Not applicable: n (%)" = 
      paste0(sum(MEM_CES == 1, na.rm = TRUE), 
             " (", format(sum(MEM_CES == 1, na.rm = TRUE) / sum(!is.na(MEM_CES)) * 100, digits = 2, nsmall = 2), ")"),

    # Pregnancy Outcome
    "Observed denominator for Preterm pregnancy endpoint (<37 weeks), n" = sum(!is.na(MAT_PRETERM_ANY)),
    "Preterm pregnancy endpoint (<37 weeks): n (%)" = 
      paste0(sum(MAT_PRETERM_ANY == 1, na.rm = TRUE), 
             " (", format(sum(MAT_PRETERM_ANY == 1, na.rm = TRUE) / sum(!is.na(MAT_PRETERM_ANY)) * 100, digits = 2, nsmall = 2), ")"),

    # Labor and Delivery
    "Observed denominator for Experienced any labor, n" = sum(!is.na(LABOR_ANY)),
    "Experienced any labor: n (%)" = 
      paste0(sum(LABOR_ANY == 1, na.rm = TRUE), 
             " (", format(sum(LABOR_ANY == 1, na.rm = TRUE) / sum(!is.na(LABOR_ANY)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for Prolonged labor, n" = sum(!is.na(PRO_LABOR)),
    "Prolonged labor: n (%)" = 
      paste0(sum(PRO_LABOR == 1, na.rm = TRUE), 
             " (", format(sum(PRO_LABOR == 1, na.rm = TRUE) / sum(!is.na(PRO_LABOR)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for Obstructed labor, n" = sum(!is.na(OBS_LABOR)),
    "Obstructed labor: n (%)" = 
      paste0(sum(OBS_LABOR == 1, na.rm = TRUE), 
             " (", format(sum(OBS_LABOR == 1, na.rm = TRUE) / sum(!is.na(OBS_LABOR)) * 100, digits = 2, nsmall = 2), ")"),

    # Hemorrhage
    "Observed denominator for Antepartum hemorrhage during ANC, n" = sum(!is.na(HEM_APH)),
    "Antepartum hemorrhage during ANC: n (%)" = 
      paste0(sum(HEM_APH == 1, na.rm = TRUE), 
             " (", format(sum(HEM_APH == 1, na.rm = TRUE) / sum(!is.na(HEM_APH)) * 100, digits = 2, nsmall = 2), ")")
      ) %>% 
      t() %>% unlist()
  )

tb_demo_a <- tb_theme1(matrix_demo_a) %>% 
  tab_header(
    title = md("**Table 2.3: Pregnancy and Labor**")
  ) %>% 

  # Grouping by Pregnancy and Labor Conditions
  tab_row_group(label = "Fetal Presentation", rows = 2:7) %>% 
  tab_row_group(label = "Membrane Status", rows = 8:11) %>% 
  tab_row_group(label = "Pregnancy Outcome", rows = 12:13) %>% 
  tab_row_group(label = "Labor and Delivery", rows = 14:19) %>% 
  tab_row_group(label = "Hemorrhage", rows = 20:21) %>% 

  # Bold the observed denominator rows
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(rows = c(
      "Observed denominator for fetal presentation, n",
      "Observed denominator for membrane status, n",
      "Observed denominator for Preterm pregnancy endpoint (<37 weeks), n",
      "Observed denominator for Experienced any labor, n",
      "Observed denominator for Prolonged labor, n",
      "Observed denominator for Obstructed labor, n",
      "Observed denominator for Antepartum hemorrhage during ANC, n"
    )))  %>%

  row_group_order(groups = c(NA, 
    "Fetal Presentation", 
    "Membrane Status", 
    "Pregnancy Outcome",
    "Labor and Delivery",
    "Hemorrhage"
  )) %>% 

  # Save table as an image
  gtsave("Pregnancy_Labor_Summary.png", expand = 10)

# Display Image in RMarkdown
knitr::include_graphics("Pregnancy_Labor_Summary.png")

```
## 2.4 Demographics and Socioeconomic Characteristics
```{r}
matrix_demo_a <- data.static %>% 
  group_by(SITE) %>% 
  summarise(
"Expected denominator, n^a^" = n(),

    # Age
    "Observed denominator for Age, n" = sum(!is.na(MAT_AGE)),
    "Age: mean (SD)" = 
      paste0(round(mean(MAT_AGE, na.rm = TRUE), digits = 2), 
             " (", format(sd(MAT_AGE, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
    # BMI at enrollment
    "Observed denominator for BMI at enrollment, n" = sum(!is.na(BMI_ENROLL)),
    "BMI at enrollment: mean (SD)" = 
      paste0(round(mean(BMI_ENROLL, na.rm = TRUE), digits = 2), 
             " (", format(sd(BMI_ENROLL, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
    # Mid‐Upper Arm Circumference (MUAC)
    "Observed denominator for MUAC, n" = sum(!is.na(MUAC_ENROLL)),
    "MUAC: mean (SD)" = 
      paste0(round(mean(MUAC_ENROLL, na.rm = TRUE), digits = 2), 
             " (", format(sd(MUAC_ENROLL, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
    # Reproductive History
    "Observed denominator for Had spontaneous miscarriage before, n" = sum(!is.na(MISCARRIAGE)),
    "Had spontaneous miscarriage before: n (%)" = 
      paste0(sum(MISCARRIAGE == 1, na.rm = TRUE), 
             " (", format(sum(MISCARRIAGE == 1, na.rm = TRUE)/sum(!is.na(MISCARRIAGE))*100, digits = 2, nsmall = 2), ")"),

    # Employment
    "Observed denominator for Has paid work, n" = sum(!is.na(PAID_WORK)),
    "Has paid work: n (%)" = 
      paste0(sum(PAID_WORK == 1, na.rm = TRUE), 
             " (", format(sum(PAID_WORK == 1, na.rm = TRUE)/sum(!is.na(PAID_WORK))*100, digits = 2, nsmall = 2), ")"),

    # Parity
    "Observed denominator for Parity status, n" = sum(!is.na(PARITY_0)),
    "Parity status 0: n (%)" = 
      paste0(sum(PARITY_0 == 1, na.rm = TRUE), 
             " (", format(sum(PARITY_0 == 1, na.rm = TRUE)/sum(!is.na(PARITY_0))*100, digits = 2, nsmall = 2), ")"),

    "Parity status 1: n (%)" = 
      paste0(sum(PARITY_1 == 1, na.rm = TRUE), 
             " (", format(sum(PARITY_1 == 1, na.rm = TRUE)/sum(!is.na(PARITY_1))*100, digits = 2, nsmall = 2), ")"),

    "Parity status 2+: n (%)" = 
      paste0(sum(PARITY_2 == 1, na.rm = TRUE), 
             " (", format(sum(PARITY_2 == 1, na.rm = TRUE)/sum(!is.na(PARITY_2))*100, digits = 2, nsmall = 2), ")"),

    # Wealth Quintiles
    "Observed denominator for Wealth quintile, n" = sum(!is.na(WEALTH_QUINT_1) & WEALTH_QUINT_55==0),
    "Wealth quintile 1: n (%)" = 
      paste0(sum(WEALTH_QUINT_1 == 1, na.rm = TRUE), 
             " (", format(sum(WEALTH_QUINT_1 == 1, na.rm = TRUE)/sum(!is.na(WEALTH_QUINT_1))*100, digits = 2, nsmall = 2), ")"),

    "Wealth quintile 2: n (%)" = 
      paste0(sum(WEALTH_QUINT_2 == 1, na.rm = TRUE), 
             " (", format(sum(WEALTH_QUINT_2 == 1, na.rm = TRUE)/sum(!is.na(WEALTH_QUINT_2))*100, digits = 2, nsmall = 2), ")"),

    "Wealth quintile 3: n (%)" = 
      paste0(sum(WEALTH_QUINT_3 == 1, na.rm = TRUE), 
             " (", format(sum(WEALTH_QUINT_3 == 1, na.rm = TRUE)/sum(!is.na(WEALTH_QUINT_3))*100, digits = 2, nsmall = 2), ")"),

    "Wealth quintile 4: n (%)" = 
      paste0(sum(WEALTH_QUINT_4 == 1, na.rm = TRUE), 
             " (", format(sum(WEALTH_QUINT_4 == 1, na.rm = TRUE)/sum(!is.na(WEALTH_QUINT_4))*100, digits = 2, nsmall = 2), ")"),

    "Wealth quintile 5: n (%)" = 
      paste0(sum(WEALTH_QUINT_5 == 1, na.rm = TRUE), 
             " (", format(sum(WEALTH_QUINT_5 == 1, na.rm = TRUE)/sum(!is.na(WEALTH_QUINT_5))*100, digits = 2, nsmall = 2), ")")
     ) %>% 
  t() %>% as.data.frame() %>% 
  `colnames<-`(c(.[1,])) %>% 
  slice(-1) %>% 
  add_column(
    .after = 6,
    "Total" = data.static %>% 
      summarise(
"Expected denominator, n^a^" = n(),

    # Age
    "Observed denominator for Age, n" = sum(!is.na(MAT_AGE)),
    "Age: mean (SD)" = 
      paste0(round(mean(MAT_AGE, na.rm = TRUE), digits = 2), 
             " (", format(sd(MAT_AGE, na.rm = TRUE), digits = 2, nsmall = 2), ")"),

    # BMI at enrollment
    "Observed denominator for BMI at enrollment, n" = sum(!is.na(BMI_ENROLL)),
    "BMI at enrollment: mean (SD)" = 
      paste0(round(mean(BMI_ENROLL, na.rm = TRUE), digits = 2), 
             " (", format(sd(BMI_ENROLL, na.rm = TRUE), digits = 2, nsmall = 2), ")"),

    # Mid‐Upper Arm Circumference (MUAC)
    "Observed denominator for MUAC, n" = sum(!is.na(MUAC_ENROLL)),
    "MUAC: mean (SD)" = 
      paste0(round(mean(MUAC_ENROLL, na.rm = TRUE), digits = 2), 
             " (", format(sd(MUAC_ENROLL, na.rm = TRUE), digits = 2, nsmall = 2), ")"),

    # Reproductive History
    "Observed denominator for Had spontaneous miscarriage before, n" = sum(!is.na(MISCARRIAGE)),
    "Had spontaneous miscarriage before: n (%)" = 
      paste0(sum(MISCARRIAGE == 1, na.rm = TRUE), 
             " (", format(sum(MISCARRIAGE == 1, na.rm = TRUE)/sum(!is.na(MISCARRIAGE))*100, digits = 2, nsmall = 2), ")"),

    # Employment
    "Observed denominator for Has paid work, n" = sum(!is.na(PAID_WORK)),
    "Has paid work: n (%)" = 
      paste0(sum(PAID_WORK == 1, na.rm = TRUE), 
             " (", format(sum(PAID_WORK == 1, na.rm = TRUE)/sum(!is.na(PAID_WORK))*100, digits = 2, nsmall = 2), ")"),

    # Parity
    "Observed denominator for Parity status, n" = sum(!is.na(PARITY_0)),
    "Parity status 0: n (%)" = 
      paste0(sum(PARITY_0 == 1, na.rm = TRUE), 
             " (", format(sum(PARITY_0 == 1, na.rm = TRUE)/sum(!is.na(PARITY_0))*100, digits = 2, nsmall = 2), ")"),

    "Parity status 1: n (%)" = 
      paste0(sum(PARITY_1 == 1, na.rm = TRUE), 
             " (", format(sum(PARITY_1 == 1, na.rm = TRUE)/sum(!is.na(PARITY_1))*100, digits = 2, nsmall = 2), ")"),

    "Parity status 2+: n (%)" = 
      paste0(sum(PARITY_2 == 1, na.rm = TRUE), 
             " (", format(sum(PARITY_2 == 1, na.rm = TRUE)/sum(!is.na(PARITY_2))*100, digits = 2, nsmall = 2), ")"),

    # Wealth Quintiles
    "Observed denominator for Wealth quintile, n" = sum(!is.na(WEALTH_QUINT_1) & WEALTH_QUINT_55==0),
    "Wealth quintile 1: n (%)" = 
      paste0(sum(WEALTH_QUINT_1 == 1, na.rm = TRUE), 
             " (", format(sum(WEALTH_QUINT_1 == 1, na.rm = TRUE)/sum(!is.na(WEALTH_QUINT_1))*100, digits = 2, nsmall = 2), ")"),

    "Wealth quintile 2: n (%)" = 
      paste0(sum(WEALTH_QUINT_2 == 1, na.rm = TRUE), 
             " (", format(sum(WEALTH_QUINT_2 == 1, na.rm = TRUE)/sum(!is.na(WEALTH_QUINT_2))*100, digits = 2, nsmall = 2), ")"),

    "Wealth quintile 3: n (%)" = 
      paste0(sum(WEALTH_QUINT_3 == 1, na.rm = TRUE), 
             " (", format(sum(WEALTH_QUINT_3 == 1, na.rm = TRUE)/sum(!is.na(WEALTH_QUINT_3))*100, digits = 2, nsmall = 2), ")"),

    "Wealth quintile 4: n (%)" = 
      paste0(sum(WEALTH_QUINT_4 == 1, na.rm = TRUE), 
             " (", format(sum(WEALTH_QUINT_4 == 1, na.rm = TRUE)/sum(!is.na(WEALTH_QUINT_4))*100, digits = 2, nsmall = 2), ")"),

    "Wealth quintile 5: n (%)" = 
      paste0(sum(WEALTH_QUINT_5 == 1, na.rm = TRUE), 
             " (", format(sum(WEALTH_QUINT_5 == 1, na.rm = TRUE)/sum(!is.na(WEALTH_QUINT_5))*100, digits = 2, nsmall = 2), ")"),

      ) %>% 
      t() %>% unlist()
  )

tb_demo_a <- tb_theme1(matrix_demo_a) %>% 
  tab_header(
    title = md("**Table 2.4: Demographics and Socioeconomic Characteristics**")
  ) %>% 

  # Grouping Rows for Sections
  tab_row_group(
    label = "Maternal Age",
    rows = 2:3  
  ) %>% 
  tab_row_group(
    label = "BMI at enrollment",
    rows = 4:5  
  ) %>% 
  tab_row_group(
    label = "Mid-Upper Arm Circumference (MUAC)",
    rows = 6:7  
  ) %>% 
  tab_row_group(
    label = "Reproductive History",
    rows = 8:9  
  ) %>% 
  tab_row_group(
    label = "Employment",
    rows = 10:11 
  ) %>% 
  tab_row_group(
    label = "Parity Status",
    rows = 12:15  
  ) %>% 
  tab_row_group(
    label = "Wealth Quintiles",
    rows = 16:21  
  ) %>% 
  # Bold observed denominator rows for emphasis
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(rows = c(
      "Observed denominator for Age, n",
      "Observed denominator for BMI at enrollment, n",
      "Observed denominator for MUAC, n",
      "Observed denominator for Had spontaneous miscarriage before, n",
      "Observed denominator for Has paid work, n",
      "Observed denominator for Parity status, n",
      "Observed denominator for Wealth quintile, n"
    ))
  ) %>% 
  
  row_group_order(groups = c(NA, 
    "Maternal Age", 
    "BMI at enrollment", 
    "Mid-Upper Arm Circumference (MUAC)", 
    "Reproductive History", 
    "Employment", 
    "Parity Status", 
    "Wealth Quintiles"
  )) %>% 
  
  tab_footnote(
    footnote = html("<sup>a</sup> Expected denominator is PRiSMA cohort; observed denominator includes those with non-missing results.")
  ) %>%
  
  gtsave("Demographic_Socioeconomic_Summary.png", expand = 10)

knitr::include_graphics("Demographic_Socioeconomic_Summary.png")

```
## 2.5 Air & Water Pollution
```{r}
matrix_demo_a <- data.static %>% 
  group_by(SITE) %>% 
  summarise(
"Expected denominator, n^a^" = n(),
 # Household Characteristics
    "Observed denominator for Use of improved water, n" = sum(!is.na(WATER_IMPROVED)),
    "Use of improved water: n (%)" = 
      paste0(sum(WATER_IMPROVED == 1, na.rm = TRUE), 
             " (", format(sum(WATER_IMPROVED == 1, na.rm = TRUE)/sum(!is.na(WATER_IMPROVED))*100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for Use of improved toilet, n" = sum(!is.na(TOILET_IMPROVED)),
    "Use of improved toilet: n (%)" = 
      paste0(sum(TOILET_IMPROVED == 1, na.rm = TRUE), 
             " (", format(sum(TOILET_IMPROVED == 1, na.rm = TRUE)/sum(!is.na(TOILET_IMPROVED))*100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for Use of unclean cooking fuel, n" = sum(!is.na(STOVE_FUEL)),
    "Use of unclean cooking fuel: n (%)" = 
      paste0(sum(STOVE_FUEL == 1, na.rm = TRUE), 
             " (", format(sum(STOVE_FUEL == 1, na.rm = TRUE)/sum(!is.na(STOVE_FUEL))*100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for Smoking inside the house, n" = sum(!is.na(HH_SMOKE)),
    "Smoking inside the house: n (%)" = 
      paste0(sum(HH_SMOKE == 1, na.rm = TRUE), 
             " (", format(sum(HH_SMOKE == 1, na.rm = TRUE)/sum(!is.na(HH_SMOKE))*100, digits = 2, nsmall = 2), ")"),
     "Observed denominator for Smoking, n" = sum(!is.na(SMOKE)),
     "Smoking: n (%)" = 
       paste0(sum(SMOKE == 1, na.rm = TRUE), 
         " (", format(sum(SMOKE == 1, na.rm = TRUE)/sum(!is.na(SMOKE))*100, digits = 2, nsmall = 2), ")"),
      "Observed denominator for Chewing tobacco use, n" = sum(!is.na(CHEW_TOBACCO)),
      "Chewing tobacco use: n (%)" = 
      paste0(sum(CHEW_TOBACCO == 1, na.rm = TRUE), 
         " (", format(sum(CHEW_TOBACCO == 1, na.rm = TRUE)/sum(!is.na(CHEW_TOBACCO))*100, digits = 2, nsmall = 2), ")"),
      "Observed denominator for Chewing betel nut use, n" = sum(!is.na(CHEW_BETELNUT)),
      "Chewing betel nut use: n (%)" = 
      paste0(sum(CHEW_BETELNUT == 1, na.rm = TRUE), 
         " (", format(sum(CHEW_BETELNUT == 1, na.rm = TRUE)/sum(!is.na(CHEW_BETELNUT))*100, digits = 2, nsmall = 2), ")"),
     ) %>% 
  t() %>% as.data.frame() %>% 
  `colnames<-`(c(.[1,])) %>% 
  slice(-1) %>% 
  add_column(
    .after = 6,
    "Total" = data.static %>% 
      summarise(
"Expected denominator, n^a^" = n(),
 # Household Characteristics
    "Observed denominator for Use of improved water, n" = sum(!is.na(WATER_IMPROVED)),
    "Use of improved water: n (%)" = 
      paste0(sum(WATER_IMPROVED == 1, na.rm = TRUE), 
             " (", format(sum(WATER_IMPROVED == 1, na.rm = TRUE)/sum(!is.na(WATER_IMPROVED))*100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for Use of improved toilet, n" = sum(!is.na(TOILET_IMPROVED)),
    "Use of improved toilet: n (%)" = 
      paste0(sum(TOILET_IMPROVED == 1, na.rm = TRUE), 
             " (", format(sum(TOILET_IMPROVED == 1, na.rm = TRUE)/sum(!is.na(TOILET_IMPROVED))*100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for Use of unclean cooking fuel, n" = sum(!is.na(STOVE_FUEL)),
    "Use of unclean cooking fuel: n (%)" = 
      paste0(sum(STOVE_FUEL == 1, na.rm = TRUE), 
             " (", format(sum(STOVE_FUEL == 1, na.rm = TRUE)/sum(!is.na(STOVE_FUEL))*100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for Smoking inside the house, n" = sum(!is.na(HH_SMOKE)),
    "Smoking inside the house: n (%)" = 
      paste0(sum(HH_SMOKE == 1, na.rm = TRUE), 
             " (", format(sum(HH_SMOKE == 1, na.rm = TRUE)/sum(!is.na(HH_SMOKE))*100, digits = 2, nsmall = 2), ")"),
     "Observed denominator for Smoking, n" = sum(!is.na(SMOKE)),
     "Smoking: n (%)" = 
       paste0(sum(SMOKE == 1, na.rm = TRUE), 
         " (", format(sum(SMOKE == 1, na.rm = TRUE)/sum(!is.na(SMOKE))*100, digits = 2, nsmall = 2), ")"),
      "Observed denominator for Chewing tobacco use, n" = sum(!is.na(CHEW_TOBACCO)),
      "Chewing tobacco use: n (%)" = 
      paste0(sum(CHEW_TOBACCO == 1, na.rm = TRUE), 
         " (", format(sum(CHEW_TOBACCO == 1, na.rm = TRUE)/sum(!is.na(CHEW_TOBACCO))*100, digits = 2, nsmall = 2), ")"),
      "Observed denominator for Chewing betel nut use, n" = sum(!is.na(CHEW_BETELNUT)),
      "Chewing betel nut use: n (%)" = 
      paste0(sum(CHEW_BETELNUT == 1, na.rm = TRUE), 
         " (", format(sum(CHEW_BETELNUT == 1, na.rm = TRUE)/sum(!is.na(CHEW_BETELNUT))*100, digits = 2, nsmall = 2), ")"),      ) %>% 
      t() %>% unlist()
  )

tb_demo_a <- tb_theme1(matrix_demo_a) %>% 
  tab_header(
    title = md("**Table 2.5: Air & Water Pollution**")
  ) %>% 
 tab_row_group(
    label = "Use of improved water",
    rows = 2:3 
  )  %>% 
   tab_row_group(
    label = "Use of improved toilet",
    rows = 4:5  
  )  %>% 
   tab_row_group(
    label = "Use of unclean cooking fuel",
    rows = 6:7  
  )  %>% 
   tab_row_group(
    label = "Smoking inside the house",
    rows = 8:9  
  )  %>% 
   tab_row_group(
    label = "Smoking",
    rows = 10:11  
  )  %>%
     tab_row_group(
    label = "Chewing tobacco use",
    rows = 12:13  
  )  %>%
     tab_row_group(
    label = "Chewing betel nut use",
    rows = 14:15  
  )  %>%

  # Bold observed denominator rows
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(rows = c(
      "Observed denominator for Use of improved water, n",
      "Observed denominator for Use of improved toilet, n",
      "Observed denominator for Use of unclean cooking fuel, n",
      "Observed denominator for Smoking inside the house, n",
      "Observed denominator for Smoking, n",
      "Observed denominator for Chewing tobacco use, n",
      "Observed denominator for Chewing betel nut use, n"
    ))
  ) %>%

  row_group_order(groups = c(NA,
    "Use of improved water","Use of improved toilet","Use of unclean cooking fuel","Smoking inside the house","Smoking","Chewing tobacco use", "Chewing betel nut use"
  )) %>% 
  
  tab_footnote(
    footnote = html("<sup>a</sup> Expected denominator is the PRiSMA cohort; observed denominator includes those with non-missing results.")
  ) %>%
  
  gtsave("Pollution.png", expand = 10)

knitr::include_graphics("Pollution.png")

```
## 2.6 Supplement
```{r}
matrix_demo_a <- data.temporal.wide %>% 
  group_by(SITE) %>% 
  summarise(
"Expected denominator, n^a^" = n(),

    # Iron Supplement
    "Observed denominator for iron supplement - enrollment, n" = sum(!is.na(M04_IRON_ORAL_CMOCCUR_1)),
    "Iron supplement - enrollment: n (%)" = paste0(sum(M04_IRON_ORAL_CMOCCUR_1 == 1, na.rm = TRUE), " (", format(sum(M04_IRON_ORAL_CMOCCUR_1 == 1, na.rm = TRUE) / sum(!is.na(M04_IRON_ORAL_CMOCCUR_1)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for iron supplement - ANC20, n" = sum(!is.na(M04_IRON_ORAL_CMOCCUR_2)),
    "Iron supplement - ANC20: n (%)" = paste0(sum(M04_IRON_ORAL_CMOCCUR_2 == 1, na.rm = TRUE), " (", format(sum(M04_IRON_ORAL_CMOCCUR_2 == 1, na.rm = TRUE) / sum(!is.na(M04_IRON_ORAL_CMOCCUR_2)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for iron supplement - ANC28, n" = sum(!is.na(M04_IRON_ORAL_CMOCCUR_3)),
    "Iron supplement - ANC28: n (%)" = paste0(sum(M04_IRON_ORAL_CMOCCUR_3 == 1, na.rm = TRUE), " (", format(sum(M04_IRON_ORAL_CMOCCUR_3 == 1, na.rm = TRUE) / sum(!is.na(M04_IRON_ORAL_CMOCCUR_3)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for iron supplement - ANC32, n" = sum(!is.na(M04_IRON_ORAL_CMOCCUR_4)),
    "Iron supplement - ANC32: n (%)" = paste0(sum(M04_IRON_ORAL_CMOCCUR_4 == 1, na.rm = TRUE), " (", format(sum(M04_IRON_ORAL_CMOCCUR_4 == 1, na.rm = TRUE) / sum(!is.na(M04_IRON_ORAL_CMOCCUR_4)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for iron supplement - ANC36, n" = sum(!is.na(M04_IRON_ORAL_CMOCCUR_5)),
    "Iron supplement - ANC36: n (%)" = paste0(sum(M04_IRON_ORAL_CMOCCUR_5 == 1, na.rm = TRUE), " (", format(sum(M04_IRON_ORAL_CMOCCUR_5 == 1, na.rm = TRUE) / sum(!is.na(M04_IRON_ORAL_CMOCCUR_5)) * 100, digits = 2, nsmall = 2), ")"),

    # IFA
    "Observed denominator for IFA supplement - enrollment, n" = sum(!is.na(M04_IFA_CMOCCUR_1)),
    "IFA supplement - enrollment: n (%)" = paste0(sum(M04_IFA_CMOCCUR_1 == 1, na.rm = TRUE), " (", format(sum(M04_IFA_CMOCCUR_1 == 1, na.rm = TRUE) / sum(!is.na(M04_IFA_CMOCCUR_1)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for IFA supplement - ANC20, n" = sum(!is.na(M04_IFA_CMOCCUR_2)),
    "IFA supplement - ANC20: n (%)" = paste0(sum(M04_IFA_CMOCCUR_2 == 1, na.rm = TRUE), " (", format(sum(M04_IFA_CMOCCUR_2 == 1, na.rm = TRUE) / sum(!is.na(M04_IFA_CMOCCUR_2)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for IFA supplement - ANC28, n" = sum(!is.na(M04_IFA_CMOCCUR_3)),
    "IFA supplement - ANC28: n (%)" = paste0(sum(M04_IFA_CMOCCUR_3 == 1, na.rm = TRUE), " (", format(sum(M04_IFA_CMOCCUR_3 == 1, na.rm = TRUE) / sum(!is.na(M04_IFA_CMOCCUR_3)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for IFA supplement - ANC32, n" = sum(!is.na(M04_IFA_CMOCCUR_4)),
    "IFA supplement - ANC32: n (%)" = paste0(sum(M04_IFA_CMOCCUR_4 == 1, na.rm = TRUE), " (", format(sum(M04_IFA_CMOCCUR_4 == 1, na.rm = TRUE) / sum(!is.na(M04_IFA_CMOCCUR_4)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for IFA supplement - ANC36, n" = sum(!is.na(M04_IFA_CMOCCUR_5)),
    "IFA supplement - ANC36: n (%)" = paste0(sum(M04_IFA_CMOCCUR_5 == 1, na.rm = TRUE), " (", format(sum(M04_IFA_CMOCCUR_5 == 1, na.rm = TRUE) / sum(!is.na(M04_IFA_CMOCCUR_5)) * 100, digits = 2, nsmall = 2), ")"),
     ) %>% 
  t() %>% as.data.frame() %>% 
  `colnames<-`(c(.[1,])) %>% 
  slice(-1) %>% 
  add_column(
    .after = 6,
    "Total" = data.temporal.wide %>% 
      summarise(
"Expected denominator, n^a^" = n(),

    # Iron Supplement
    "Observed denominator for iron supplement - enrollment, n" = sum(!is.na(M04_IRON_ORAL_CMOCCUR_1)),
    "Iron supplement - enrollment: n (%)" = paste0(sum(M04_IRON_ORAL_CMOCCUR_1 == 1, na.rm = TRUE), " (", format(sum(M04_IRON_ORAL_CMOCCUR_1 == 1, na.rm = TRUE) / sum(!is.na(M04_IRON_ORAL_CMOCCUR_1)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for iron supplement - ANC20, n" = sum(!is.na(M04_IRON_ORAL_CMOCCUR_2)),
    "Iron supplement - ANC20: n (%)" = paste0(sum(M04_IRON_ORAL_CMOCCUR_2 == 1, na.rm = TRUE), " (", format(sum(M04_IRON_ORAL_CMOCCUR_2 == 1, na.rm = TRUE) / sum(!is.na(M04_IRON_ORAL_CMOCCUR_2)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for iron supplement - ANC28, n" = sum(!is.na(M04_IRON_ORAL_CMOCCUR_3)),
    "Iron supplement - ANC28: n (%)" = paste0(sum(M04_IRON_ORAL_CMOCCUR_3 == 1, na.rm = TRUE), " (", format(sum(M04_IRON_ORAL_CMOCCUR_3 == 1, na.rm = TRUE) / sum(!is.na(M04_IRON_ORAL_CMOCCUR_3)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for iron supplement - ANC32, n" = sum(!is.na(M04_IRON_ORAL_CMOCCUR_4)),
    "Iron supplement - ANC32: n (%)" = paste0(sum(M04_IRON_ORAL_CMOCCUR_4 == 1, na.rm = TRUE), " (", format(sum(M04_IRON_ORAL_CMOCCUR_4 == 1, na.rm = TRUE) / sum(!is.na(M04_IRON_ORAL_CMOCCUR_4)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for iron supplement - ANC36, n" = sum(!is.na(M04_IRON_ORAL_CMOCCUR_5)),
    "Iron supplement - ANC36: n (%)" = paste0(sum(M04_IRON_ORAL_CMOCCUR_5 == 1, na.rm = TRUE), " (", format(sum(M04_IRON_ORAL_CMOCCUR_5 == 1, na.rm = TRUE) / sum(!is.na(M04_IRON_ORAL_CMOCCUR_5)) * 100, digits = 2, nsmall = 2), ")"),

    # IFA
    "Observed denominator for IFA supplement - enrollment, n" = sum(!is.na(M04_IFA_CMOCCUR_1)),
    "IFA supplement - enrollment: n (%)" = paste0(sum(M04_IFA_CMOCCUR_1 == 1, na.rm = TRUE), " (", format(sum(M04_IFA_CMOCCUR_1 == 1, na.rm = TRUE) / sum(!is.na(M04_IFA_CMOCCUR_1)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for IFA supplement - ANC20, n" = sum(!is.na(M04_IFA_CMOCCUR_2)),
    "IFA supplement - ANC20: n (%)" = paste0(sum(M04_IFA_CMOCCUR_2 == 1, na.rm = TRUE), " (", format(sum(M04_IFA_CMOCCUR_2 == 1, na.rm = TRUE) / sum(!is.na(M04_IFA_CMOCCUR_2)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for IFA supplement - ANC28, n" = sum(!is.na(M04_IFA_CMOCCUR_3)),
    "IFA supplement - ANC28: n (%)" = paste0(sum(M04_IFA_CMOCCUR_3 == 1, na.rm = TRUE), " (", format(sum(M04_IFA_CMOCCUR_3 == 1, na.rm = TRUE) / sum(!is.na(M04_IFA_CMOCCUR_3)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for IFA supplement - ANC32, n" = sum(!is.na(M04_IFA_CMOCCUR_4)),
    "IFA supplement - ANC32: n (%)" = paste0(sum(M04_IFA_CMOCCUR_4 == 1, na.rm = TRUE), " (", format(sum(M04_IFA_CMOCCUR_4 == 1, na.rm = TRUE) / sum(!is.na(M04_IFA_CMOCCUR_4)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for IFA supplement - ANC36, n" = sum(!is.na(M04_IFA_CMOCCUR_5)),
    "IFA supplement - ANC36: n (%)" = paste0(sum(M04_IFA_CMOCCUR_5 == 1, na.rm = TRUE), " (", format(sum(M04_IFA_CMOCCUR_5 == 1, na.rm = TRUE) / sum(!is.na(M04_IFA_CMOCCUR_5)) * 100, digits = 2, nsmall = 2), ")"),
      ) %>% 
      t() %>% unlist()
  )

tb_demo_a <- tb_theme1(matrix_demo_a) %>% 
  tab_header(
    title = md("**Table 2.6: Supplement**")
  ) %>% 
  
  # Group rows by supplement type
  tab_row_group(
    label = "Iron Supplement",
    rows = 2:11
  ) %>% 
  tab_row_group(
    label = "IFA Supplement",
    rows = 12:21
  ) %>% 

  # Bold observed denominator rows for emphasis
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(rows = c(
      "Observed denominator for iron supplement - enrollment, n",
      "Observed denominator for iron supplement - ANC20, n",
      "Observed denominator for iron supplement - ANC28, n",
      "Observed denominator for iron supplement - ANC32, n",
      "Observed denominator for iron supplement - ANC36, n",
      
      "Observed denominator for IFA supplement - enrollment, n",
      "Observed denominator for IFA supplement - ANC20, n",
      "Observed denominator for IFA supplement - ANC28, n",
      "Observed denominator for IFA supplement - ANC32, n",
      "Observed denominator for IFA supplement - ANC36, n"
    ))
  ) %>% 
  
  row_group_order(groups = c(NA, 
    "Iron Supplement", 
    "IFA Supplement"
  )) %>% 
  
  tab_footnote(
    footnote = html("<sup>a</sup> Expected denominator is PRiSMA cohort; observed denominator includes those with non-missing results.")
  ) %>%
  
  gtsave("Supplement_1.png", expand = 10)

# Optionally include the saved image in report
knitr::include_graphics("Supplement_1.png")

```
```{r}
matrix_demo_a <- data.temporal.wide %>% 
  group_by(SITE) %>% 
  summarise(
"Expected denominator, n^a^" = n(),
 # Calcium
    "Observed denominator for calcium supplement - enrollment, n" = sum(!is.na(M04_CALCIUM_CMOCCUR_1)),
    "Calcium supplement - enrollment: n (%)" = paste0(sum(M04_CALCIUM_CMOCCUR_1 == 1, na.rm = TRUE), " (", format(sum(M04_CALCIUM_CMOCCUR_1 == 1, na.rm = TRUE) / sum(!is.na(M04_CALCIUM_CMOCCUR_1)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for calcium supplement - ANC20, n" = sum(!is.na(M04_CALCIUM_CMOCCUR_2)),
    "Calcium supplement - ANC20: n (%)" = paste0(sum(M04_CALCIUM_CMOCCUR_2 == 1, na.rm = TRUE), " (", format(sum(M04_CALCIUM_CMOCCUR_2 == 1, na.rm = TRUE) / sum(!is.na(M04_CALCIUM_CMOCCUR_2)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for calcium supplement - ANC28, n" = sum(!is.na(M04_CALCIUM_CMOCCUR_3)),
    "Calcium supplement - ANC28: n (%)" = paste0(sum(M04_CALCIUM_CMOCCUR_3 == 1, na.rm = TRUE), " (", format(sum(M04_CALCIUM_CMOCCUR_3 == 1, na.rm = TRUE) / sum(!is.na(M04_CALCIUM_CMOCCUR_3)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for calcium supplement - ANC32, n" = sum(!is.na(M04_CALCIUM_CMOCCUR_4)),
    "Calcium supplement - ANC32: n (%)" = paste0(sum(M04_CALCIUM_CMOCCUR_4 == 1, na.rm = TRUE), " (", format(sum(M04_CALCIUM_CMOCCUR_4 == 1, na.rm = TRUE) / sum(!is.na(M04_CALCIUM_CMOCCUR_4)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for calcium supplement - ANC36, n" = sum(!is.na(M04_CALCIUM_CMOCCUR_5)),
    "Calcium supplement - ANC36: n (%)" = paste0(sum(M04_CALCIUM_CMOCCUR_5 == 1, na.rm = TRUE), " (", format(sum(M04_CALCIUM_CMOCCUR_5 == 1, na.rm = TRUE) / sum(!is.na(M04_CALCIUM_CMOCCUR_5)) * 100, digits = 2, nsmall = 2), ")"),

    # Vitamin A
    "Observed denominator for vitamin A supplement - enrollment, n" = sum(!is.na(M04_VITAMIN_A_CMOCCUR_1)),
    "Vitamin A supplement - enrollment: n (%)" = paste0(sum(M04_VITAMIN_A_CMOCCUR_1 == 1, na.rm = TRUE), " (", format(sum(M04_VITAMIN_A_CMOCCUR_1 == 1, na.rm = TRUE) / sum(!is.na(M04_VITAMIN_A_CMOCCUR_1)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for vitamin A supplement - ANC20, n" = sum(!is.na(M04_VITAMIN_A_CMOCCUR_2)),
    "Vitamin A supplement - ANC20: n (%)" = paste0(sum(M04_VITAMIN_A_CMOCCUR_2 == 1, na.rm = TRUE), " (", format(sum(M04_VITAMIN_A_CMOCCUR_2 == 1, na.rm = TRUE) / sum(!is.na(M04_VITAMIN_A_CMOCCUR_2)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for vitamin A supplement - ANC28, n" = sum(!is.na(M04_VITAMIN_A_CMOCCUR_3)),
    "Vitamin A supplement - ANC28: n (%)" = paste0(sum(M04_VITAMIN_A_CMOCCUR_3 == 1, na.rm = TRUE), " (", format(sum(M04_VITAMIN_A_CMOCCUR_3 == 1, na.rm = TRUE) / sum(!is.na(M04_VITAMIN_A_CMOCCUR_3)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for vitamin A supplement - ANC32, n" = sum(!is.na(M04_VITAMIN_A_CMOCCUR_4)),
    "Vitamin A supplement - ANC32: n (%)" = paste0(sum(M04_VITAMIN_A_CMOCCUR_4 == 1, na.rm = TRUE), " (", format(sum(M04_VITAMIN_A_CMOCCUR_4 == 1, na.rm = TRUE) / sum(!is.na(M04_VITAMIN_A_CMOCCUR_4)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for vitamin A supplement - ANC36, n" = sum(!is.na(M04_VITAMIN_A_CMOCCUR_5)),
    "Vitamin A supplement - ANC36: n (%)" = paste0(sum(M04_VITAMIN_A_CMOCCUR_5 == 1, na.rm = TRUE), " (", format(sum(M04_VITAMIN_A_CMOCCUR_5 == 1, na.rm = TRUE) / sum(!is.na(M04_VITAMIN_A_CMOCCUR_5)) * 100, digits = 2, nsmall = 2), ")"),
     ) %>% 
  t() %>% as.data.frame() %>% 
  `colnames<-`(c(.[1,])) %>% 
  slice(-1) %>% 
  add_column(
    .after = 6,
    "Total" = data.temporal.wide %>% 
      summarise(
"Expected denominator, n^a^" = n(),
 # Calcium
    "Observed denominator for calcium supplement - enrollment, n" = sum(!is.na(M04_CALCIUM_CMOCCUR_1)),
    "Calcium supplement - enrollment: n (%)" = paste0(sum(M04_CALCIUM_CMOCCUR_1 == 1, na.rm = TRUE), " (", format(sum(M04_CALCIUM_CMOCCUR_1 == 1, na.rm = TRUE) / sum(!is.na(M04_CALCIUM_CMOCCUR_1)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for calcium supplement - ANC20, n" = sum(!is.na(M04_CALCIUM_CMOCCUR_2)),
    "Calcium supplement - ANC20: n (%)" = paste0(sum(M04_CALCIUM_CMOCCUR_2 == 1, na.rm = TRUE), " (", format(sum(M04_CALCIUM_CMOCCUR_2 == 1, na.rm = TRUE) / sum(!is.na(M04_CALCIUM_CMOCCUR_2)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for calcium supplement - ANC28, n" = sum(!is.na(M04_CALCIUM_CMOCCUR_3)),
    "Calcium supplement - ANC28: n (%)" = paste0(sum(M04_CALCIUM_CMOCCUR_3 == 1, na.rm = TRUE), " (", format(sum(M04_CALCIUM_CMOCCUR_3 == 1, na.rm = TRUE) / sum(!is.na(M04_CALCIUM_CMOCCUR_3)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for calcium supplement - ANC32, n" = sum(!is.na(M04_CALCIUM_CMOCCUR_4)),
    "Calcium supplement - ANC32: n (%)" = paste0(sum(M04_CALCIUM_CMOCCUR_4 == 1, na.rm = TRUE), " (", format(sum(M04_CALCIUM_CMOCCUR_4 == 1, na.rm = TRUE) / sum(!is.na(M04_CALCIUM_CMOCCUR_4)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for calcium supplement - ANC36, n" = sum(!is.na(M04_CALCIUM_CMOCCUR_5)),
    "Calcium supplement - ANC36: n (%)" = paste0(sum(M04_CALCIUM_CMOCCUR_5 == 1, na.rm = TRUE), " (", format(sum(M04_CALCIUM_CMOCCUR_5 == 1, na.rm = TRUE) / sum(!is.na(M04_CALCIUM_CMOCCUR_5)) * 100, digits = 2, nsmall = 2), ")"),

    # Vitamin A
    "Observed denominator for vitamin A supplement - enrollment, n" = sum(!is.na(M04_VITAMIN_A_CMOCCUR_1)),
    "Vitamin A supplement - enrollment: n (%)" = paste0(sum(M04_VITAMIN_A_CMOCCUR_1 == 1, na.rm = TRUE), " (", format(sum(M04_VITAMIN_A_CMOCCUR_1 == 1, na.rm = TRUE) / sum(!is.na(M04_VITAMIN_A_CMOCCUR_1)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for vitamin A supplement - ANC20, n" = sum(!is.na(M04_VITAMIN_A_CMOCCUR_2)),
    "Vitamin A supplement - ANC20: n (%)" = paste0(sum(M04_VITAMIN_A_CMOCCUR_2 == 1, na.rm = TRUE), " (", format(sum(M04_VITAMIN_A_CMOCCUR_2 == 1, na.rm = TRUE) / sum(!is.na(M04_VITAMIN_A_CMOCCUR_2)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for vitamin A supplement - ANC28, n" = sum(!is.na(M04_VITAMIN_A_CMOCCUR_3)),
    "Vitamin A supplement - ANC28: n (%)" = paste0(sum(M04_VITAMIN_A_CMOCCUR_3 == 1, na.rm = TRUE), " (", format(sum(M04_VITAMIN_A_CMOCCUR_3 == 1, na.rm = TRUE) / sum(!is.na(M04_VITAMIN_A_CMOCCUR_3)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for vitamin A supplement - ANC32, n" = sum(!is.na(M04_VITAMIN_A_CMOCCUR_4)),
    "Vitamin A supplement - ANC32: n (%)" = paste0(sum(M04_VITAMIN_A_CMOCCUR_4 == 1, na.rm = TRUE), " (", format(sum(M04_VITAMIN_A_CMOCCUR_4 == 1, na.rm = TRUE) / sum(!is.na(M04_VITAMIN_A_CMOCCUR_4)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for vitamin A supplement - ANC36, n" = sum(!is.na(M04_VITAMIN_A_CMOCCUR_5)),
    "Vitamin A supplement - ANC36: n (%)" = paste0(sum(M04_VITAMIN_A_CMOCCUR_5 == 1, na.rm = TRUE), " (", format(sum(M04_VITAMIN_A_CMOCCUR_5 == 1, na.rm = TRUE) / sum(!is.na(M04_VITAMIN_A_CMOCCUR_5)) * 100, digits = 2, nsmall = 2), ")"),
    ) %>% 
      t() %>% unlist()
  )

tb_demo_a <- tb_theme1(matrix_demo_a) %>% 
  tab_header(
    title = md("**Table 7: Supplement (continued)**")
  ) %>% 
 tab_row_group(
    label = "Calcium Supplement",
    rows = 2:11
  ) %>% 
  tab_row_group(
    label = "Vitamin A Supplement",
    rows = 12:21
  ) %>% 

  # Bold observed denominator rows
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(rows = c(
     "Observed denominator for calcium supplement - enrollment, n",
      "Observed denominator for calcium supplement - ANC20, n",
      "Observed denominator for calcium supplement - ANC28, n",
      "Observed denominator for calcium supplement - ANC32, n",
      "Observed denominator for calcium supplement - ANC36, n",
      
      "Observed denominator for vitamin A supplement - enrollment, n",
      "Observed denominator for vitamin A supplement - ANC20, n",
      "Observed denominator for vitamin A supplement - ANC28, n",
      "Observed denominator for vitamin A supplement - ANC32, n",
      "Observed denominator for vitamin A supplement - ANC36, n"
    ))
  ) %>%

  row_group_order(groups = c(NA,
    "Calcium Supplement", 
    "Vitamin A Supplement"
  )) %>% 
  
  tab_footnote(
    footnote = html("<sup>a</sup> Expected denominator is the PRiSMA cohort; observed denominator includes those with non-missing results.")
  ) %>%
  
  gtsave("Supplement_2.png", expand = 10)

knitr::include_graphics("Supplement_2.png")

```
```{r}
matrix_demo_a <- data.temporal.wide %>% 
  group_by(SITE) %>% 
  summarise(
"Expected denominator, n^a^" = n(),
 # Multiple Micronutrient
    "Observed denominator for MMN supplement - enrollment, n" = sum(!is.na(M04_MICRONUTRIENT_CMOCCUR_1)),
    "MMN supplement - enrollment: n (%)" = paste0(sum(M04_MICRONUTRIENT_CMOCCUR_1 == 1, na.rm = TRUE), " (", format(sum(M04_MICRONUTRIENT_CMOCCUR_1 == 1, na.rm = TRUE) / sum(!is.na(M04_MICRONUTRIENT_CMOCCUR_1)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for MMN supplement - ANC20, n" = sum(!is.na(M04_MICRONUTRIENT_CMOCCUR_2)),
    "MMN supplement - ANC20: n (%)" = paste0(sum(M04_MICRONUTRIENT_CMOCCUR_2 == 1, na.rm = TRUE), " (", format(sum(M04_MICRONUTRIENT_CMOCCUR_2 == 1, na.rm = TRUE) / sum(!is.na(M04_MICRONUTRIENT_CMOCCUR_2)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for MMN supplement - ANC28, n" = sum(!is.na(M04_MICRONUTRIENT_CMOCCUR_3)),
    "MMN supplement - ANC28: n (%)" = paste0(sum(M04_MICRONUTRIENT_CMOCCUR_3 == 1, na.rm = TRUE), " (", format(sum(M04_MICRONUTRIENT_CMOCCUR_3 == 1, na.rm = TRUE) / sum(!is.na(M04_MICRONUTRIENT_CMOCCUR_3)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for MMN supplement - ANC32, n" = sum(!is.na(M04_MICRONUTRIENT_CMOCCUR_4)),
    "MMN supplement - ANC32: n (%)" = paste0(sum(M04_MICRONUTRIENT_CMOCCUR_4 == 1, na.rm = TRUE), " (", format(sum(M04_MICRONUTRIENT_CMOCCUR_4 == 1, na.rm = TRUE) / sum(!is.na(M04_MICRONUTRIENT_CMOCCUR_4)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for MMN supplement - ANC36, n" = sum(!is.na(M04_MICRONUTRIENT_CMOCCUR_5)),
    "MMN supplement - ANC36: n (%)" = paste0(sum(M04_MICRONUTRIENT_CMOCCUR_5 == 1, na.rm = TRUE), " (", format(sum(M04_MICRONUTRIENT_CMOCCUR_5 == 1, na.rm = TRUE) / sum(!is.na(M04_MICRONUTRIENT_CMOCCUR_5)) * 100, digits = 2, nsmall = 2), ")"),

    # Anthelmintic
    "Observed denominator for anthelmintic treatment - enrollment, n" = sum(!is.na(M04_ANTHELMINTHIC_CMOCCUR_1)),
    "Anthelmintic treatment - enrollment: n (%)" = paste0(sum(M04_ANTHELMINTHIC_CMOCCUR_1 == 1, na.rm = TRUE), " (", format(sum(M04_ANTHELMINTHIC_CMOCCUR_1 == 1, na.rm = TRUE) / sum(!is.na(M04_ANTHELMINTHIC_CMOCCUR_1)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for anthelmintic treatment - ANC20, n" = sum(!is.na(M04_ANTHELMINTHIC_CMOCCUR_2)),
    "Anthelmintic treatment - ANC20: n (%)" = paste0(sum(M04_ANTHELMINTHIC_CMOCCUR_2 == 1, na.rm = TRUE), " (", format(sum(M04_ANTHELMINTHIC_CMOCCUR_2 == 1, na.rm = TRUE) / sum(!is.na(M04_ANTHELMINTHIC_CMOCCUR_2)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for anthelmintic treatment - ANC28, n" = sum(!is.na(M04_ANTHELMINTHIC_CMOCCUR_3)),
    "Anthelmintic treatment - ANC28: n (%)" = paste0(sum(M04_ANTHELMINTHIC_CMOCCUR_3 == 1, na.rm = TRUE), " (", format(sum(M04_ANTHELMINTHIC_CMOCCUR_3 == 1, na.rm = TRUE) / sum(!is.na(M04_ANTHELMINTHIC_CMOCCUR_3)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for anthelmintic treatment - ANC32, n" = sum(!is.na(M04_ANTHELMINTHIC_CMOCCUR_4)),
    "Anthelmintic treatment - ANC32: n (%)" = paste0(sum(M04_ANTHELMINTHIC_CMOCCUR_4 == 1, na.rm = TRUE), " (", format(sum(M04_ANTHELMINTHIC_CMOCCUR_4 == 1, na.rm = TRUE) / sum(!is.na(M04_ANTHELMINTHIC_CMOCCUR_4)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for anthelmintic treatment - ANC36, n" = sum(!is.na(M04_ANTHELMINTHIC_CMOCCUR_5)),
    "Anthelmintic treatment - ANC36: n (%)" = paste0(sum(M04_ANTHELMINTHIC_CMOCCUR_5 == 1, na.rm = TRUE), " (", format(sum(M04_ANTHELMINTHIC_CMOCCUR_5 == 1, na.rm = TRUE) / sum(!is.na(M04_ANTHELMINTHIC_CMOCCUR_5)) * 100, digits = 2, nsmall = 2), ")")
     ) %>% 
  t() %>% as.data.frame() %>% 
  `colnames<-`(c(.[1,])) %>% 
  slice(-1) %>% 
  add_column(
    .after = 6,
    "Total" = data.temporal.wide %>% 
      summarise(
"Expected denominator, n^a^" = n(),
# Multiple Micronutrient
    "Observed denominator for MMN supplement - enrollment, n" = sum(!is.na(M04_MICRONUTRIENT_CMOCCUR_1)),
    "MMN supplement - enrollment: n (%)" = paste0(sum(M04_MICRONUTRIENT_CMOCCUR_1 == 1, na.rm = TRUE), " (", format(sum(M04_MICRONUTRIENT_CMOCCUR_1 == 1, na.rm = TRUE) / sum(!is.na(M04_MICRONUTRIENT_CMOCCUR_1)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for MMN supplement - ANC20, n" = sum(!is.na(M04_MICRONUTRIENT_CMOCCUR_2)),
    "MMN supplement - ANC20: n (%)" = paste0(sum(M04_MICRONUTRIENT_CMOCCUR_2 == 1, na.rm = TRUE), " (", format(sum(M04_MICRONUTRIENT_CMOCCUR_2 == 1, na.rm = TRUE) / sum(!is.na(M04_MICRONUTRIENT_CMOCCUR_2)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for MMN supplement - ANC28, n" = sum(!is.na(M04_MICRONUTRIENT_CMOCCUR_3)),
    "MMN supplement - ANC28: n (%)" = paste0(sum(M04_MICRONUTRIENT_CMOCCUR_3 == 1, na.rm = TRUE), " (", format(sum(M04_MICRONUTRIENT_CMOCCUR_3 == 1, na.rm = TRUE) / sum(!is.na(M04_MICRONUTRIENT_CMOCCUR_3)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for MMN supplement - ANC32, n" = sum(!is.na(M04_MICRONUTRIENT_CMOCCUR_4)),
    "MMN supplement - ANC32: n (%)" = paste0(sum(M04_MICRONUTRIENT_CMOCCUR_4 == 1, na.rm = TRUE), " (", format(sum(M04_MICRONUTRIENT_CMOCCUR_4 == 1, na.rm = TRUE) / sum(!is.na(M04_MICRONUTRIENT_CMOCCUR_4)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for MMN supplement - ANC36, n" = sum(!is.na(M04_MICRONUTRIENT_CMOCCUR_5)),
    "MMN supplement - ANC36: n (%)" = paste0(sum(M04_MICRONUTRIENT_CMOCCUR_5 == 1, na.rm = TRUE), " (", format(sum(M04_MICRONUTRIENT_CMOCCUR_5 == 1, na.rm = TRUE) / sum(!is.na(M04_MICRONUTRIENT_CMOCCUR_5)) * 100, digits = 2, nsmall = 2), ")"),

    # Anthelmintic
    "Observed denominator for anthelmintic treatment - enrollment, n" = sum(!is.na(M04_ANTHELMINTHIC_CMOCCUR_1)),
    "Anthelmintic treatment - enrollment: n (%)" = paste0(sum(M04_ANTHELMINTHIC_CMOCCUR_1 == 1, na.rm = TRUE), " (", format(sum(M04_ANTHELMINTHIC_CMOCCUR_1 == 1, na.rm = TRUE) / sum(!is.na(M04_ANTHELMINTHIC_CMOCCUR_1)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for anthelmintic treatment - ANC20, n" = sum(!is.na(M04_ANTHELMINTHIC_CMOCCUR_2)),
    "Anthelmintic treatment - ANC20: n (%)" = paste0(sum(M04_ANTHELMINTHIC_CMOCCUR_2 == 1, na.rm = TRUE), " (", format(sum(M04_ANTHELMINTHIC_CMOCCUR_2 == 1, na.rm = TRUE) / sum(!is.na(M04_ANTHELMINTHIC_CMOCCUR_2)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for anthelmintic treatment - ANC28, n" = sum(!is.na(M04_ANTHELMINTHIC_CMOCCUR_3)),
    "Anthelmintic treatment - ANC28: n (%)" = paste0(sum(M04_ANTHELMINTHIC_CMOCCUR_3 == 1, na.rm = TRUE), " (", format(sum(M04_ANTHELMINTHIC_CMOCCUR_3 == 1, na.rm = TRUE) / sum(!is.na(M04_ANTHELMINTHIC_CMOCCUR_3)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for anthelmintic treatment - ANC32, n" = sum(!is.na(M04_ANTHELMINTHIC_CMOCCUR_4)),
    "Anthelmintic treatment - ANC32: n (%)" = paste0(sum(M04_ANTHELMINTHIC_CMOCCUR_4 == 1, na.rm = TRUE), " (", format(sum(M04_ANTHELMINTHIC_CMOCCUR_4 == 1, na.rm = TRUE) / sum(!is.na(M04_ANTHELMINTHIC_CMOCCUR_4)) * 100, digits = 2, nsmall = 2), ")"),

    "Observed denominator for anthelmintic treatment - ANC36, n" = sum(!is.na(M04_ANTHELMINTHIC_CMOCCUR_5)),
    "Anthelmintic treatment - ANC36: n (%)" = paste0(sum(M04_ANTHELMINTHIC_CMOCCUR_5 == 1, na.rm = TRUE), " (", format(sum(M04_ANTHELMINTHIC_CMOCCUR_5 == 1, na.rm = TRUE) / sum(!is.na(M04_ANTHELMINTHIC_CMOCCUR_5)) * 100, digits = 2, nsmall = 2), ")")
    ) %>% 
      t() %>% unlist()
  )

tb_demo_a <- tb_theme1(matrix_demo_a) %>% 
  tab_header(
    title = md("**Table 7: Supplement (continued)**")
  ) %>% 
  tab_row_group(
    label = "Multiple Micronutrients (MMN)",
    rows = 2:11
  ) %>% 
  tab_row_group(
    label = "Anthelmintic treatment",
    rows = 12:21
  ) %>% 

  # Bold observed denominator rows
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(rows = c(
      "Observed denominator for MMN supplement - enrollment, n",
      "Observed denominator for MMN supplement - ANC20, n",
      "Observed denominator for MMN supplement - ANC28, n",
      "Observed denominator for MMN supplement - ANC32, n",
      "Observed denominator for MMN supplement - ANC36, n",
      
      "Observed denominator for anthelmintic treatment - enrollment, n",
      "Observed denominator for anthelmintic treatment - ANC20, n",
      "Observed denominator for anthelmintic treatment - ANC28, n",
      "Observed denominator for anthelmintic treatment - ANC32, n",
      "Observed denominator for anthelmintic treatment - ANC36, n"
    ))
  ) %>%

  row_group_order(groups = c(NA,
    "Multiple Micronutrients (MMN)", 
    "Anthelmintic treatment"
  )) %>% 
  
  tab_footnote(
    footnote = html("<sup>a</sup> Expected denominator is the PRiSMA cohort; observed denominator includes those with non-missing results.")
  ) %>%
  
  gtsave("Supplement_3.png", expand = 10)

knitr::include_graphics("Supplement_3.png")

```
## 2.7 Micronutrients
### 2.7.1 Iron
```{r}
matrix_demo_a <- data.temporal.wide %>% 
  group_by(SITE) %>% 
  summarise(
"Expected denominator, n^a^" = n(),
# Ferritin
"Observed denominator for Ferritin - Enrollment, n" = sum(!is.na(M08_FERRITIN_LBORRES_1)),
"Ferritin - Enrollment: mean (SD)" = paste0(round(mean(M08_FERRITIN_LBORRES_1, na.rm = TRUE), digits = 2), " (", format(sd(M08_FERRITIN_LBORRES_1, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Ferritin - ANC20, n" = sum(!is.na(M08_FERRITIN_LBORRES_2)),
"Ferritin - ANC20: mean (SD)" = paste0(round(mean(M08_FERRITIN_LBORRES_2, na.rm = TRUE), digits = 2), " (", format(sd(M08_FERRITIN_LBORRES_2, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Ferritin - ANC28, n" = sum(!is.na(M08_FERRITIN_LBORRES_3)),
"Ferritin - ANC28: mean (SD)" = paste0(round(mean(M08_FERRITIN_LBORRES_3, na.rm = TRUE), digits = 2), " (", format(sd(M08_FERRITIN_LBORRES_3, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Ferritin - ANC32, n" = sum(!is.na(M08_FERRITIN_LBORRES_4)),
"Ferritin - ANC32: mean (SD)" = paste0(round(mean(M08_FERRITIN_LBORRES_4, na.rm = TRUE), digits = 2), " (", format(sd(M08_FERRITIN_LBORRES_4, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Ferritin - ANC36, n" = sum(!is.na(M08_FERRITIN_LBORRES_5)),
"Ferritin - ANC36: mean (SD)" = paste0(round(mean(M08_FERRITIN_LBORRES_5, na.rm = TRUE), digits = 2), " (", format(sd(M08_FERRITIN_LBORRES_5, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
# TIBC
"Observed denominator for TIBC - Enrollment, n" = sum(!is.na(M08_IRON_TOT_UGDL_LBORRES_1)),
"TIBC - Enrollment: mean (SD)" = paste0(round(mean(M08_IRON_TOT_UGDL_LBORRES_1, na.rm = TRUE), digits = 2), " (", format(sd(M08_IRON_TOT_UGDL_LBORRES_1, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for TIBC - ANC20, n" = sum(!is.na(M08_IRON_TOT_UGDL_LBORRES_2)),
"TIBC - ANC20: mean (SD)" = paste0(round(mean(M08_IRON_TOT_UGDL_LBORRES_2, na.rm = TRUE), digits = 2), " (", format(sd(M08_IRON_TOT_UGDL_LBORRES_2, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for TIBC - ANC28, n" = sum(!is.na(M08_IRON_TOT_UGDL_LBORRES_3)),
"TIBC - ANC28: mean (SD)" = paste0(round(mean(M08_IRON_TOT_UGDL_LBORRES_3, na.rm = TRUE), digits = 2), " (", format(sd(M08_IRON_TOT_UGDL_LBORRES_3, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for TIBC - ANC32, n" = sum(!is.na(M08_IRON_TOT_UGDL_LBORRES_4)),
"TIBC - ANC32: mean (SD)" = paste0(round(mean(M08_IRON_TOT_UGDL_LBORRES_4, na.rm = TRUE), digits = 2), " (", format(sd(M08_IRON_TOT_UGDL_LBORRES_4, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for TIBC - ANC36, n" = sum(!is.na(M08_IRON_TOT_UGDL_LBORRES_5)),
"TIBC - ANC36: mean (SD)" = paste0(round(mean(M08_IRON_TOT_UGDL_LBORRES_5, na.rm = TRUE), digits = 2), " (", format(sd(M08_IRON_TOT_UGDL_LBORRES_5, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
     ) %>% 
  t() %>% as.data.frame() %>% 
  `colnames<-`(c(.[1,])) %>% 
  slice(-1) %>% 
  add_column(
    .after = 6,
    "Total" = data.temporal.wide %>% 
      summarise(
"Expected denominator, n^a^" = n(),
# Ferritin
"Observed denominator for Ferritin - Enrollment, n" = sum(!is.na(M08_FERRITIN_LBORRES_1)),
"Ferritin - Enrollment: mean (SD)" = paste0(round(mean(M08_FERRITIN_LBORRES_1, na.rm = TRUE), digits = 2), " (", format(sd(M08_FERRITIN_LBORRES_1, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Ferritin - ANC20, n" = sum(!is.na(M08_FERRITIN_LBORRES_2)),
"Ferritin - ANC20: mean (SD)" = paste0(round(mean(M08_FERRITIN_LBORRES_2, na.rm = TRUE), digits = 2), " (", format(sd(M08_FERRITIN_LBORRES_2, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Ferritin - ANC28, n" = sum(!is.na(M08_FERRITIN_LBORRES_3)),
"Ferritin - ANC28: mean (SD)" = paste0(round(mean(M08_FERRITIN_LBORRES_3, na.rm = TRUE), digits = 2), " (", format(sd(M08_FERRITIN_LBORRES_3, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Ferritin - ANC32, n" = sum(!is.na(M08_FERRITIN_LBORRES_4)),
"Ferritin - ANC32: mean (SD)" = paste0(round(mean(M08_FERRITIN_LBORRES_4, na.rm = TRUE), digits = 2), " (", format(sd(M08_FERRITIN_LBORRES_4, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Ferritin - ANC36, n" = sum(!is.na(M08_FERRITIN_LBORRES_5)),
"Ferritin - ANC36: mean (SD)" = paste0(round(mean(M08_FERRITIN_LBORRES_5, na.rm = TRUE), digits = 2), " (", format(sd(M08_FERRITIN_LBORRES_5, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
# TIBC
"Observed denominator for TIBC - Enrollment, n" = sum(!is.na(M08_IRON_TOT_UGDL_LBORRES_1)),
"TIBC - Enrollment: mean (SD)" = paste0(round(mean(M08_IRON_TOT_UGDL_LBORRES_1, na.rm = TRUE), digits = 2), " (", format(sd(M08_IRON_TOT_UGDL_LBORRES_1, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for TIBC - ANC20, n" = sum(!is.na(M08_IRON_TOT_UGDL_LBORRES_2)),
"TIBC - ANC20: mean (SD)" = paste0(round(mean(M08_IRON_TOT_UGDL_LBORRES_2, na.rm = TRUE), digits = 2), " (", format(sd(M08_IRON_TOT_UGDL_LBORRES_2, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for TIBC - ANC28, n" = sum(!is.na(M08_IRON_TOT_UGDL_LBORRES_3)),
"TIBC - ANC28: mean (SD)" = paste0(round(mean(M08_IRON_TOT_UGDL_LBORRES_3, na.rm = TRUE), digits = 2), " (", format(sd(M08_IRON_TOT_UGDL_LBORRES_3, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for TIBC - ANC32, n" = sum(!is.na(M08_IRON_TOT_UGDL_LBORRES_4)),
"TIBC - ANC32: mean (SD)" = paste0(round(mean(M08_IRON_TOT_UGDL_LBORRES_4, na.rm = TRUE), digits = 2), " (", format(sd(M08_IRON_TOT_UGDL_LBORRES_4, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for TIBC - ANC36, n" = sum(!is.na(M08_IRON_TOT_UGDL_LBORRES_5)),
"TIBC - ANC36: mean (SD)" = paste0(round(mean(M08_IRON_TOT_UGDL_LBORRES_5, na.rm = TRUE), digits = 2), " (", format(sd(M08_IRON_TOT_UGDL_LBORRES_5, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
      ) %>% 
      t() %>% unlist()
  )

tb_demo_a <- tb_theme1(matrix_demo_a) %>% 
  tab_header(
    title = md("**Table 2.7.1: Iron Biomarker**")
  ) %>% 

  # Grouping Rows
  tab_row_group(
    label = "Ferritin (µg/dL)",
    rows = 2:11
  ) %>% 
  tab_row_group(
    label = "Total Iron-Binding Capacity (TIBC, µg/dL)",
    rows = 12:21
  ) %>% 

  # Bold observed denominator rows
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(rows = c(
      "Observed denominator for Ferritin - Enrollment, n",
      "Observed denominator for Ferritin - ANC20, n",
      "Observed denominator for Ferritin - ANC28, n",
      "Observed denominator for Ferritin - ANC32, n",
      "Observed denominator for Ferritin - ANC36, n",
      "Observed denominator for TIBC - Enrollment, n",
      "Observed denominator for TIBC - ANC20, n",
      "Observed denominator for TIBC - ANC28, n",
      "Observed denominator for TIBC - ANC32, n",
      "Observed denominator for TIBC - ANC36, n"
    ))
  ) %>%

  row_group_order(groups = c(NA,
    "Ferritin (µg/dL)", 
    "Total Iron-Binding Capacity (TIBC, µg/dL)"
  )) %>% 
  
  tab_footnote(
    footnote = html("<sup>a</sup> Expected denominator is the PRiSMA cohort; observed denominator includes those with non-missing results.")
  ) %>%
  
  gtsave("Micronutrient_Iron_Biomarkers_1.png", expand = 10)

knitr::include_graphics("Micronutrient_Iron_Biomarkers_1.png")

```
```{r}
matrix_demo_a <- data.temporal.wide %>% 
  group_by(SITE) %>% 
  summarise(
"Expected denominator, n^a^" = n(),
# Hepcidin
"Observed denominator for hepcidin - Enrollment, n" = sum(!is.na(M08_IRON_HEP_LBORRES_1)),
"Hepcidin - Enrollment: mean (SD)" = paste0(round(mean(M08_IRON_HEP_LBORRES_1, na.rm = TRUE), digits = 2), " (", format(sd(M08_IRON_HEP_LBORRES_1, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for hepcidin - ANC20, n" = sum(!is.na(M08_IRON_HEP_LBORRES_2)),
"Hepcidin - ANC20: mean (SD)" = paste0(round(mean(M08_IRON_HEP_LBORRES_2, na.rm = TRUE), digits = 2), " (", format(sd(M08_IRON_HEP_LBORRES_2, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for hepcidin - ANC28, n" = sum(!is.na(M08_IRON_HEP_LBORRES_3)),
"Hepcidin - ANC28: mean (SD)" = paste0(round(mean(M08_IRON_HEP_LBORRES_3, na.rm = TRUE), digits = 2), " (", format(sd(M08_IRON_HEP_LBORRES_3, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for hepcidin - ANC32, n" = sum(!is.na(M08_IRON_HEP_LBORRES_4)),
"Hepcidin - ANC32: mean (SD)" = paste0(round(mean(M08_IRON_HEP_LBORRES_4, na.rm = TRUE), digits = 2), " (", format(sd(M08_IRON_HEP_LBORRES_4, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for hepcidin - ANC36, n" = sum(!is.na(M08_IRON_HEP_LBORRES_5)),
"Hepcidin - ANC36: mean (SD)" = paste0(round(mean(M08_IRON_HEP_LBORRES_5, na.rm = TRUE), digits = 2), " (", format(sd(M08_IRON_HEP_LBORRES_5, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
     ) %>% 
  t() %>% as.data.frame() %>% 
  `colnames<-`(c(.[1,])) %>% 
  slice(-1) %>% 
  add_column(
    .after = 6,
    "Total" = data.temporal.wide %>% 
      summarise(
"Expected denominator, n^a^" = n(),
# Hepcidin
"Observed denominator for hepcidin - Enrollment, n" = sum(!is.na(M08_IRON_HEP_LBORRES_1)),
"Hepcidin - Enrollment: mean (SD)" = paste0(round(mean(M08_IRON_HEP_LBORRES_1, na.rm = TRUE), digits = 2), " (", format(sd(M08_IRON_HEP_LBORRES_1, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for hepcidin - ANC20, n" = sum(!is.na(M08_IRON_HEP_LBORRES_2)),
"Hepcidin - ANC20: mean (SD)" = paste0(round(mean(M08_IRON_HEP_LBORRES_2, na.rm = TRUE), digits = 2), " (", format(sd(M08_IRON_HEP_LBORRES_2, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for hepcidin - ANC28, n" = sum(!is.na(M08_IRON_HEP_LBORRES_3)),
"Hepcidin - ANC28: mean (SD)" = paste0(round(mean(M08_IRON_HEP_LBORRES_3, na.rm = TRUE), digits = 2), " (", format(sd(M08_IRON_HEP_LBORRES_3, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for hepcidin - ANC32, n" = sum(!is.na(M08_IRON_HEP_LBORRES_4)),
"Hepcidin - ANC32: mean (SD)" = paste0(round(mean(M08_IRON_HEP_LBORRES_4, na.rm = TRUE), digits = 2), " (", format(sd(M08_IRON_HEP_LBORRES_4, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for hepcidin - ANC36, n" = sum(!is.na(M08_IRON_HEP_LBORRES_5)),
"Hepcidin - ANC36: mean (SD)" = paste0(round(mean(M08_IRON_HEP_LBORRES_5, na.rm = TRUE), digits = 2), " (", format(sd(M08_IRON_HEP_LBORRES_5, na.rm = TRUE), digits = 2, nsmall = 2), ")"), 
      ) %>% 
      t() %>% unlist()
  )

tb_demo_a <- tb_theme1(matrix_demo_a) %>% 
  tab_header(
    title = md("**Table 2.7.1: Iron Biomarker (continued)**")
  ) %>% 
  tab_row_group(
    label = "Hepcidin (ng/mL)",
    rows = 2:11
  ) %>% 

  # Bold observed denominator rows
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(rows = c(
      "Observed denominator for hepcidin - Enrollment, n",
      "Observed denominator for hepcidin - ANC20, n",
      "Observed denominator for hepcidin - ANC28, n",
      "Observed denominator for hepcidin - ANC32, n",
      "Observed denominator for hepcidin - ANC36, n"
    ))
  ) %>%

  row_group_order(groups = c(NA,
    "Hepcidin (ng/mL)"
  )) %>% 
  
  tab_footnote(
    footnote = html("<sup>a</sup> Expected denominator is the PRiSMA cohort; observed denominator includes those with non-missing results.")
  ) %>%
  
  gtsave("Micronutrient_Iron_Biomarkers_2.png", expand = 10)

knitr::include_graphics("Micronutrient_Iron_Biomarkers_2.png")

```
### 2.7.2 Vitamin B12
```{r}
matrix_demo_a <- data.temporal.wide %>% 
  group_by(SITE) %>% 
  summarise(
"Expected denominator, n^a^" = n(),
# Vitamin B12 (Total Cobalamin)
"Observed denominator for Vitamin B12 (Total Cobalamin) - Enrollment, n" = sum(!is.na(M08_VITB12_COB_LBORRES_1)),
"Vitamin B12 (Total Cobalamin) - Enrollment: mean (SD)" = paste0(round(mean(M08_VITB12_COB_LBORRES_1, na.rm = TRUE), digits = 2), " (", format(sd(M08_VITB12_COB_LBORRES_1, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Vitamin B12 (Total Cobalamin) - ANC20, n" = sum(!is.na(M08_VITB12_COB_LBORRES_2)),
"Vitamin B12 (Total Cobalamin) - ANC20: mean (SD)" = paste0(round(mean(M08_VITB12_COB_LBORRES_2, na.rm = TRUE), digits = 2), " (", format(sd(M08_VITB12_COB_LBORRES_2, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Vitamin B12 (Total Cobalamin) - ANC28, n" = sum(!is.na(M08_VITB12_COB_LBORRES_3)),
"Vitamin B12 (Total Cobalamin) - ANC28: mean (SD)" = paste0(round(mean(M08_VITB12_COB_LBORRES_3, na.rm = TRUE), digits = 2), " (", format(sd(M08_VITB12_COB_LBORRES_3, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Vitamin B12 (Total Cobalamin) - ANC32, n" = sum(!is.na(M08_VITB12_COB_LBORRES_4)),
"Vitamin B12 (Total Cobalamin) - ANC32: mean (SD)" = paste0(round(mean(M08_VITB12_COB_LBORRES_4, na.rm = TRUE), digits = 2), " (", format(sd(M08_VITB12_COB_LBORRES_4, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Vitamin B12 (Total Cobalamin) - ANC36, n" = sum(!is.na(M08_VITB12_COB_LBORRES_5)),
"Vitamin B12 (Total Cobalamin) - ANC36: mean (SD)" = paste0(round(mean(M08_VITB12_COB_LBORRES_5, na.rm = TRUE), digits = 2), " (", format(sd(M08_VITB12_COB_LBORRES_5, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
# Vitamin B12 (Holotranscobalamin)
"Observed denominator for Vitamin B12 (Holotranscobalamin) - Enrollment, n" = sum(!is.na(M08_VITB12_COB_LBORRES_1)),
"Vitamin B12 (Holotranscobalamin) - Enrollment: mean (SD)" = paste0(round(mean(M08_VITB12_COB_LBORRES_1, na.rm = TRUE), digits = 2), " (", format(sd(M08_VITB12_COB_LBORRES_1, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Vitamin B12 (Holotranscobalamin) - ANC20, n" = sum(!is.na(M08_VITB12_COB_LBORRES_2)),
"Vitamin B12 (Holotranscobalamin) - ANC20: mean (SD)" = paste0(round(mean(M08_VITB12_COB_LBORRES_2, na.rm = TRUE), digits = 2), " (", format(sd(M08_VITB12_COB_LBORRES_2, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Vitamin B12 (Holotranscobalamin) - ANC28, n" = sum(!is.na(M08_VITB12_COB_LBORRES_3)),
"Vitamin B12 (Holotranscobalamin) - ANC28: mean (SD)" = paste0(round(mean(M08_VITB12_COB_LBORRES_3, na.rm = TRUE), digits = 2), " (", format(sd(M08_VITB12_COB_LBORRES_3, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Vitamin B12 (Holotranscobalamin) - ANC32, n" = sum(!is.na(M08_VITB12_COB_LBORRES_4)),
"Vitamin B12 (Holotranscobalamin) - ANC32: mean (SD)" = paste0(round(mean(M08_VITB12_COB_LBORRES_4, na.rm = TRUE), digits = 2), " (", format(sd(M08_VITB12_COB_LBORRES_4, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Vitamin B12 (Holotranscobalamin) - ANC36, n" = sum(!is.na(M08_VITB12_COB_LBORRES_5)),
"Vitamin B12 (Holotranscobalamin) - ANC36: mean (SD)" = paste0(round(mean(M08_VITB12_COB_LBORRES_5, na.rm = TRUE), digits = 2), " (", format(sd(M08_VITB12_COB_LBORRES_5, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
     ) %>% 
  t() %>% as.data.frame() %>% 
  `colnames<-`(c(.[1,])) %>% 
  slice(-1) %>% 
  add_column(
    .after = 6,
    "Total" = data.temporal.wide %>% 
      summarise(
"Expected denominator, n^a^" = n(),
# Vitamin B12 (Total Cobalamin)
"Observed denominator for Vitamin B12 (Total Cobalamin) - Enrollment, n" = sum(!is.na(M08_VITB12_COB_LBORRES_1)),
"Vitamin B12 (Total Cobalamin) - Enrollment: mean (SD)" = paste0(round(mean(M08_VITB12_COB_LBORRES_1, na.rm = TRUE), digits = 2), " (", format(sd(M08_VITB12_COB_LBORRES_1, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Vitamin B12 (Total Cobalamin) - ANC20, n" = sum(!is.na(M08_VITB12_COB_LBORRES_2)),
"Vitamin B12 (Total Cobalamin) - ANC20: mean (SD)" = paste0(round(mean(M08_VITB12_COB_LBORRES_2, na.rm = TRUE), digits = 2), " (", format(sd(M08_VITB12_COB_LBORRES_2, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Vitamin B12 (Total Cobalamin) - ANC28, n" = sum(!is.na(M08_VITB12_COB_LBORRES_3)),
"Vitamin B12 (Total Cobalamin) - ANC28: mean (SD)" = paste0(round(mean(M08_VITB12_COB_LBORRES_3, na.rm = TRUE), digits = 2), " (", format(sd(M08_VITB12_COB_LBORRES_3, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Vitamin B12 (Total Cobalamin) - ANC32, n" = sum(!is.na(M08_VITB12_COB_LBORRES_4)),
"Vitamin B12 (Total Cobalamin) - ANC32: mean (SD)" = paste0(round(mean(M08_VITB12_COB_LBORRES_4, na.rm = TRUE), digits = 2), " (", format(sd(M08_VITB12_COB_LBORRES_4, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Vitamin B12 (Total Cobalamin) - ANC36, n" = sum(!is.na(M08_VITB12_COB_LBORRES_5)),
"Vitamin B12 (Total Cobalamin) - ANC36: mean (SD)" = paste0(round(mean(M08_VITB12_COB_LBORRES_5, na.rm = TRUE), digits = 2), " (", format(sd(M08_VITB12_COB_LBORRES_5, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
# Vitamin B12 (Holotranscobalamin)
"Observed denominator for Vitamin B12 (Holotranscobalamin) - Enrollment, n" = sum(!is.na(M08_VITB12_COB_LBORRES_1)),
"Vitamin B12 (Holotranscobalamin) - Enrollment: mean (SD)" = paste0(round(mean(M08_VITB12_COB_LBORRES_1, na.rm = TRUE), digits = 2), " (", format(sd(M08_VITB12_COB_LBORRES_1, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Vitamin B12 (Holotranscobalamin) - ANC20, n" = sum(!is.na(M08_VITB12_COB_LBORRES_2)),
"Vitamin B12 (Holotranscobalamin) - ANC20: mean (SD)" = paste0(round(mean(M08_VITB12_COB_LBORRES_2, na.rm = TRUE), digits = 2), " (", format(sd(M08_VITB12_COB_LBORRES_2, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Vitamin B12 (Holotranscobalamin) - ANC28, n" = sum(!is.na(M08_VITB12_COB_LBORRES_3)),
"Vitamin B12 (Holotranscobalamin) - ANC28: mean (SD)" = paste0(round(mean(M08_VITB12_COB_LBORRES_3, na.rm = TRUE), digits = 2), " (", format(sd(M08_VITB12_COB_LBORRES_3, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Vitamin B12 (Holotranscobalamin) - ANC32, n" = sum(!is.na(M08_VITB12_COB_LBORRES_4)),
"Vitamin B12 (Holotranscobalamin) - ANC32: mean (SD)" = paste0(round(mean(M08_VITB12_COB_LBORRES_4, na.rm = TRUE), digits = 2), " (", format(sd(M08_VITB12_COB_LBORRES_4, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Vitamin B12 (Holotranscobalamin) - ANC36, n" = sum(!is.na(M08_VITB12_COB_LBORRES_5)),
"Vitamin B12 (Holotranscobalamin) - ANC36: mean (SD)" = paste0(round(mean(M08_VITB12_COB_LBORRES_5, na.rm = TRUE), digits = 2), " (", format(sd(M08_VITB12_COB_LBORRES_5, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
      ) %>% 
      t() %>% unlist()
  )

tb_demo_a <- tb_theme1(matrix_demo_a) %>% 
  tab_header(
    title = md("**Table 2.7.2: Vitamin B12**")
  ) %>% 

  # Grouping Rows
  tab_row_group(
    label = "Vitamin B12 (Total Cobalamin, pg/mL)",
    rows = 2:11
  ) %>% 
  tab_row_group(
    label = "Vitamin B12 (Holotranscobalamin, pg/mL)",
    rows = 12:21
  ) %>% 

  # Bold observed denominator rows
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(rows = c(
      "Observed denominator for Vitamin B12 (Total Cobalamin) - Enrollment, n",
      "Observed denominator for Vitamin B12 (Total Cobalamin) - ANC20, n",
      "Observed denominator for Vitamin B12 (Total Cobalamin) - ANC28, n",
      "Observed denominator for Vitamin B12 (Total Cobalamin) - ANC32, n",
      "Observed denominator for Vitamin B12 (Total Cobalamin) - ANC36, n",
      "Observed denominator for Vitamin B12 (Holotranscobalamin) - Enrollment, n",
      "Observed denominator for Vitamin B12 (Holotranscobalamin) - ANC20, n",
      "Observed denominator for Vitamin B12 (Holotranscobalamin) - ANC28, n",
      "Observed denominator for Vitamin B12 (Holotranscobalamin) - ANC32, n",
      "Observed denominator for Vitamin B12 (Holotranscobalamin) - ANC36, n"
    ))
  ) %>%

  row_group_order(groups = c(
    "Vitamin B12 (Total Cobalamin, pg/mL)", 
    "Vitamin B12 (Holotranscobalamin, pg/mL)"
  )) %>% 
  
  tab_footnote(
    footnote = html("<sup>a</sup> Expected denominator is the PRiSMA cohort; observed denominator includes those with non-missing results.")
  ) %>%
  
  gtsave("Micronutrient_Vitamin_B12_Biomarkers.png", expand = 10)

knitr::include_graphics("Micronutrient_Vitamin_B12_Biomarkers.png")

```
### 2.7.3 Vitamin A
```{r}
matrix_demo_a <- data.temporal.wide %>% 
  group_by(SITE) %>% 
  summarise(
"Expected denominator, n^a^" = n(),
# Vitamin A (serum retinol)
"Observed denominator for Vitamin A (serum retinol) - Enrollment, n" = sum(!is.na(M08_VITA_UGDL_LBORRES_1)),
"Vitamin A (serum retinol) - Enrollment: mean (SD)" = paste0(round(mean(M08_VITA_UGDL_LBORRES_1, na.rm = TRUE), digits = 2), " (", format(sd(M08_VITA_UGDL_LBORRES_1, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Vitamin A (serum retinol) - ANC20, n" = sum(!is.na(M08_VITA_UGDL_LBORRES_2)),
"Vitamin A (serum retinol) - ANC20: mean (SD)" = paste0(round(mean(M08_VITA_UGDL_LBORRES_2, na.rm = TRUE), digits = 2), " (", format(sd(M08_VITA_UGDL_LBORRES_2, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Vitamin A (serum retinol) - ANC28, n" = sum(!is.na(M08_VITA_UGDL_LBORRES_3)),
"Vitamin A (serum retinol) - ANC28: mean (SD)" = paste0(round(mean(M08_VITA_UGDL_LBORRES_3, na.rm = TRUE), digits = 2), " (", format(sd(M08_VITA_UGDL_LBORRES_3, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Vitamin A (serum retinol) - ANC32, n" = sum(!is.na(M08_VITA_UGDL_LBORRES_4)),
"Vitamin A (serum retinol) - ANC32: mean (SD)" = paste0(round(mean(M08_VITA_UGDL_LBORRES_4, na.rm = TRUE), digits = 2), " (", format(sd(M08_VITA_UGDL_LBORRES_4, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Vitamin A (serum retinol) - ANC36, n" = sum(!is.na(M08_VITA_UGDL_LBORRES_5)),
"Vitamin A (serum retinol) - ANC36: mean (SD)" = paste0(round(mean(M08_VITA_UGDL_LBORRES_5, na.rm = TRUE), digits = 2), " (", format(sd(M08_VITA_UGDL_LBORRES_5, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
# Vitamin A (RBP4)
"Observed denominator for Vitamin A (RBP4) - Enrollment, n" = sum(!is.na(M08_RBP4_LBORRES_1)),
"Vitamin A (RBP4) - Enrollment: mean (SD)" = paste0(round(mean(M08_RBP4_LBORRES_1, na.rm = TRUE), digits = 2), " (", format(sd(M08_RBP4_LBORRES_1, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Vitamin A (RBP4) - ANC20, n" = sum(!is.na(M08_RBP4_LBORRES_2)),
"Vitamin A (RBP4) - ANC20: mean (SD)" = paste0(round(mean(M08_RBP4_LBORRES_2, na.rm = TRUE), digits = 2), " (", format(sd(M08_RBP4_LBORRES_2, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Vitamin A (RBP4) - ANC28, n" = sum(!is.na(M08_RBP4_LBORRES_3)),
"Vitamin A (RBP4) - ANC28: mean (SD)" = paste0(round(mean(M08_RBP4_LBORRES_3, na.rm = TRUE), digits = 2), " (", format(sd(M08_RBP4_LBORRES_3, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Vitamin A (RBP4) - ANC32, n" = sum(!is.na(M08_RBP4_LBORRES_4)),
"Vitamin A (RBP4) - ANC32: mean (SD)" = paste0(round(mean(M08_RBP4_LBORRES_4, na.rm = TRUE), digits = 2), " (", format(sd(M08_RBP4_LBORRES_4, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Vitamin A (RBP4) - ANC36, n" = sum(!is.na(M08_RBP4_LBORRES_5)),
"Vitamin A (RBP4) - ANC36: mean (SD)" = paste0(round(mean(M08_RBP4_LBORRES_5, na.rm = TRUE), digits = 2), " (", format(sd(M08_RBP4_LBORRES_5, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
     ) %>% 
  t() %>% as.data.frame() %>% 
  `colnames<-`(c(.[1,])) %>% 
  slice(-1) %>% 
  add_column(
    .after = 6,
    "Total" = data.temporal.wide %>% 
      summarise(
"Expected denominator, n^a^" = n(),
# Vitamin A (serum retinol)
"Observed denominator for Vitamin A (serum retinol) - Enrollment, n" = sum(!is.na(M08_VITA_UGDL_LBORRES_1)),
"Vitamin A (serum retinol) - Enrollment: mean (SD)" = paste0(round(mean(M08_VITA_UGDL_LBORRES_1, na.rm = TRUE), digits = 2), " (", format(sd(M08_VITA_UGDL_LBORRES_1, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Vitamin A (serum retinol) - ANC20, n" = sum(!is.na(M08_VITA_UGDL_LBORRES_2)),
"Vitamin A (serum retinol) - ANC20: mean (SD)" = paste0(round(mean(M08_VITA_UGDL_LBORRES_2, na.rm = TRUE), digits = 2), " (", format(sd(M08_VITA_UGDL_LBORRES_2, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Vitamin A (serum retinol) - ANC28, n" = sum(!is.na(M08_VITA_UGDL_LBORRES_3)),
"Vitamin A (serum retinol) - ANC28: mean (SD)" = paste0(round(mean(M08_VITA_UGDL_LBORRES_3, na.rm = TRUE), digits = 2), " (", format(sd(M08_VITA_UGDL_LBORRES_3, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Vitamin A (serum retinol) - ANC32, n" = sum(!is.na(M08_VITA_UGDL_LBORRES_4)),
"Vitamin A (serum retinol) - ANC32: mean (SD)" = paste0(round(mean(M08_VITA_UGDL_LBORRES_4, na.rm = TRUE), digits = 2), " (", format(sd(M08_VITA_UGDL_LBORRES_4, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Vitamin A (serum retinol) - ANC36, n" = sum(!is.na(M08_VITA_UGDL_LBORRES_5)),
"Vitamin A (serum retinol) - ANC36: mean (SD)" = paste0(round(mean(M08_VITA_UGDL_LBORRES_5, na.rm = TRUE), digits = 2), " (", format(sd(M08_VITA_UGDL_LBORRES_5, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
# Vitamin A (RBP4)
"Observed denominator for Vitamin A (RBP4) - Enrollment, n" = sum(!is.na(M08_RBP4_LBORRES_1)),
"Vitamin A (RBP4) - Enrollment: mean (SD)" = paste0(round(mean(M08_RBP4_LBORRES_1, na.rm = TRUE), digits = 2), " (", format(sd(M08_RBP4_LBORRES_1, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Vitamin A (RBP4) - ANC20, n" = sum(!is.na(M08_RBP4_LBORRES_2)),
"Vitamin A (RBP4) - ANC20: mean (SD)" = paste0(round(mean(M08_RBP4_LBORRES_2, na.rm = TRUE), digits = 2), " (", format(sd(M08_RBP4_LBORRES_2, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Vitamin A (RBP4) - ANC28, n" = sum(!is.na(M08_RBP4_LBORRES_3)),
"Vitamin A (RBP4) - ANC28: mean (SD)" = paste0(round(mean(M08_RBP4_LBORRES_3, na.rm = TRUE), digits = 2), " (", format(sd(M08_RBP4_LBORRES_3, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Vitamin A (RBP4) - ANC32, n" = sum(!is.na(M08_RBP4_LBORRES_4)),
"Vitamin A (RBP4) - ANC32: mean (SD)" = paste0(round(mean(M08_RBP4_LBORRES_4, na.rm = TRUE), digits = 2), " (", format(sd(M08_RBP4_LBORRES_4, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Vitamin A (RBP4) - ANC36, n" = sum(!is.na(M08_RBP4_LBORRES_5)),
"Vitamin A (RBP4) - ANC36: mean (SD)" = paste0(round(mean(M08_RBP4_LBORRES_5, na.rm = TRUE), digits = 2), " (", format(sd(M08_RBP4_LBORRES_5, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
    ) %>% 
      t() %>% unlist()
  )

tb_demo_a <- tb_theme1(matrix_demo_a) %>% 
  tab_header(
    title = md("**Table 2.7.3: Vitamin A**")
  ) %>% 
  tab_row_group(
    label = "Vitamin A (serum retinol, µg/dL)",
    rows = 2:11
  ) %>% 
  tab_row_group(
    label = "Vitamin A (RBP4, µmol/L)",
    rows = 12:21
  ) %>% 

  # Bold observed denominator rows
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(rows = c(
      "Observed denominator for Vitamin A (serum retinol) - Enrollment, n",
      "Observed denominator for Vitamin A (serum retinol) - ANC20, n",
      "Observed denominator for Vitamin A (serum retinol) - ANC28, n",
      "Observed denominator for Vitamin A (serum retinol) - ANC32, n",
      "Observed denominator for Vitamin A (serum retinol) - ANC36, n",
      
      "Observed denominator for Vitamin A (RBP4) - Enrollment, n",
      "Observed denominator for Vitamin A (RBP4) - ANC20, n",
      "Observed denominator for Vitamin A (RBP4) - ANC28, n",
      "Observed denominator for Vitamin A (RBP4) - ANC32, n",
      "Observed denominator for Vitamin A (RBP4) - ANC36, n"
    ))
  ) %>%

  row_group_order(groups = c(NA,
    "Vitamin A (serum retinol, µg/dL)", 
    "Vitamin A (RBP4, µmol/L)"
  )) %>% 
  
  tab_footnote(
    footnote = html("<sup>a</sup> Expected denominator is the PRiSMA cohort; observed denominator includes those with non-missing results.")
  ) %>%
  
  gtsave("Micronutrient_Vitamin_A_Biomarkers.png", expand = 10)

knitr::include_graphics("Micronutrient_Vitamin_A_Biomarkers.png")

```
## 2.8 CBC Biomarkers
```{r}
matrix_demo_a <- data.temporal.wide %>% 
  group_by(SITE) %>% 
  summarise(
"Expected denominator, n^a^" = n(),
# MCV
"Observed denominator for MCV - Enrollment, n" = sum(!is.na(M08_CBC_MCV_LBORRES_1)),
"MCV - Enrollment: mean (SD)" = paste0(round(mean(M08_CBC_MCV_LBORRES_1, na.rm = TRUE), digits = 2), " (", format(sd(M08_CBC_MCV_LBORRES_1, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for MCV - ANC20, n" = sum(!is.na(M08_CBC_MCV_LBORRES_2)),
"MCV - ANC20: mean (SD)" = paste0(round(mean(M08_CBC_MCV_LBORRES_2, na.rm = TRUE), digits = 2), " (", format(sd(M08_CBC_MCV_LBORRES_2, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for MCV - ANC28, n" = sum(!is.na(M08_CBC_MCV_LBORRES_3)),
"MCV - ANC28: mean (SD)" = paste0(round(mean(M08_CBC_MCV_LBORRES_3, na.rm = TRUE), digits = 2), " (", format(sd(M08_CBC_MCV_LBORRES_3, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for MCV - ANC32, n" = sum(!is.na(M08_CBC_MCV_LBORRES_4)),
"MCV - ANC32: mean (SD)" = paste0(round(mean(M08_CBC_MCV_LBORRES_4, na.rm = TRUE), digits = 2), " (", format(sd(M08_CBC_MCV_LBORRES_4, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for MCV - ANC36, n" = sum(!is.na(M08_CBC_MCV_LBORRES_5)),
"MCV - ANC36: mean (SD)" = paste0(round(mean(M08_CBC_MCV_LBORRES_5, na.rm = TRUE), digits = 2), " (", format(sd(M08_CBC_MCV_LBORRES_5, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
# Hemoglobin
"Observed denominator for Hemoglobin - Enrollment, n" = sum(!is.na(M08_CBC_HB_LBORRES_1)),
"Hemoglobin - Enrollment: mean (SD)" = paste0(round(mean(M08_CBC_HB_LBORRES_1, na.rm = TRUE), digits = 2), " (", format(sd(M08_CBC_HB_LBORRES_1, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Hemoglobin - ANC20, n" = sum(!is.na(M08_CBC_HB_LBORRES_2)),
"Hemoglobin - ANC20: mean (SD)" = paste0(round(mean(M08_CBC_HB_LBORRES_2, na.rm = TRUE), digits = 2), " (", format(sd(M08_CBC_HB_LBORRES_2, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Hemoglobin - ANC28, n" = sum(!is.na(M08_CBC_HB_LBORRES_3)),
"Hemoglobin - ANC28: mean (SD)" = paste0(round(mean(M08_CBC_HB_LBORRES_3, na.rm = TRUE), digits = 2), " (", format(sd(M08_CBC_HB_LBORRES_3, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Hemoglobin - ANC32, n" = sum(!is.na(M08_CBC_HB_LBORRES_4)),
"Hemoglobin - ANC32: mean (SD)" = paste0(round(mean(M08_CBC_HB_LBORRES_4, na.rm = TRUE), digits = 2), " (", format(sd(M08_CBC_HB_LBORRES_4, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Hemoglobin - ANC36, n" = sum(!is.na(M08_CBC_HB_LBORRES_5)),
"Hemoglobin - ANC36: mean (SD)" = paste0(round(mean(M08_CBC_HB_LBORRES_5, na.rm = TRUE), digits = 2), " (", format(sd(M08_CBC_HB_LBORRES_5, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
     ) %>% 
  t() %>% as.data.frame() %>% 
  `colnames<-`(c(.[1,])) %>% 
  slice(-1) %>% 
  add_column(
    .after = 6,
    "Total" = data.temporal.wide %>% 
      summarise(
"Expected denominator, n^a^" = n(),
# MCV
"Observed denominator for MCV - Enrollment, n" = sum(!is.na(M08_CBC_MCV_LBORRES_1)),
"MCV - Enrollment: mean (SD)" = paste0(round(mean(M08_CBC_MCV_LBORRES_1, na.rm = TRUE), digits = 2), " (", format(sd(M08_CBC_MCV_LBORRES_1, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for MCV - ANC20, n" = sum(!is.na(M08_CBC_MCV_LBORRES_2)),
"MCV - ANC20: mean (SD)" = paste0(round(mean(M08_CBC_MCV_LBORRES_2, na.rm = TRUE), digits = 2), " (", format(sd(M08_CBC_MCV_LBORRES_2, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for MCV - ANC28, n" = sum(!is.na(M08_CBC_MCV_LBORRES_3)),
"MCV - ANC28: mean (SD)" = paste0(round(mean(M08_CBC_MCV_LBORRES_3, na.rm = TRUE), digits = 2), " (", format(sd(M08_CBC_MCV_LBORRES_3, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for MCV - ANC32, n" = sum(!is.na(M08_CBC_MCV_LBORRES_4)),
"MCV - ANC32: mean (SD)" = paste0(round(mean(M08_CBC_MCV_LBORRES_4, na.rm = TRUE), digits = 2), " (", format(sd(M08_CBC_MCV_LBORRES_4, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for MCV - ANC36, n" = sum(!is.na(M08_CBC_MCV_LBORRES_5)),
"MCV - ANC36: mean (SD)" = paste0(round(mean(M08_CBC_MCV_LBORRES_5, na.rm = TRUE), digits = 2), " (", format(sd(M08_CBC_MCV_LBORRES_5, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
# Hemoglobin
"Observed denominator for Hemoglobin - Enrollment, n" = sum(!is.na(M08_CBC_HB_LBORRES_1)),
"Hemoglobin - Enrollment: mean (SD)" = paste0(round(mean(M08_CBC_HB_LBORRES_1, na.rm = TRUE), digits = 2), " (", format(sd(M08_CBC_HB_LBORRES_1, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Hemoglobin - ANC20, n" = sum(!is.na(M08_CBC_HB_LBORRES_2)),
"Hemoglobin - ANC20: mean (SD)" = paste0(round(mean(M08_CBC_HB_LBORRES_2, na.rm = TRUE), digits = 2), " (", format(sd(M08_CBC_HB_LBORRES_2, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Hemoglobin - ANC28, n" = sum(!is.na(M08_CBC_HB_LBORRES_3)),
"Hemoglobin - ANC28: mean (SD)" = paste0(round(mean(M08_CBC_HB_LBORRES_3, na.rm = TRUE), digits = 2), " (", format(sd(M08_CBC_HB_LBORRES_3, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Hemoglobin - ANC32, n" = sum(!is.na(M08_CBC_HB_LBORRES_4)),
"Hemoglobin - ANC32: mean (SD)" = paste0(round(mean(M08_CBC_HB_LBORRES_4, na.rm = TRUE), digits = 2), " (", format(sd(M08_CBC_HB_LBORRES_4, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for Hemoglobin - ANC36, n" = sum(!is.na(M08_CBC_HB_LBORRES_5)),
"Hemoglobin - ANC36: mean (SD)" = paste0(round(mean(M08_CBC_HB_LBORRES_5, na.rm = TRUE), digits = 2), " (", format(sd(M08_CBC_HB_LBORRES_5, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
    ) %>% 
      t() %>% unlist()
  )

tb_demo_a <- tb_theme1(matrix_demo_a) %>% 
  tab_header(
    title = md("**Table 2.8: Complete Blood Count**")
  ) %>% 
  tab_row_group(
    label = "Mean Cell Volume (µm^3)",
    rows = 2:11
  ) %>% 
  tab_row_group(
    label = "Hemoglobin (g/dL)",
    rows = 12:21
  ) %>% 

  # Bold observed denominator rows
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(rows = c(
      "Observed denominator for MCV - Enrollment, n",
      "Observed denominator for MCV - ANC20, n",
      "Observed denominator for MCV - ANC28, n",
      "Observed denominator for MCV - ANC32, n",
      "Observed denominator for MCV - ANC36, n",
      
      "Observed denominator for Hemoglobin - Enrollment, n",
      "Observed denominator for Hemoglobin - ANC20, n",
      "Observed denominator for Hemoglobin - ANC28, n",
      "Observed denominator for Hemoglobin - ANC32, n",
      "Observed denominator for Hemoglobin - ANC36, n"
    ))
  ) %>%

  row_group_order(groups = c(NA,
    "Mean Cell Volume (µm^3)", 
    "Hemoglobin (g/dL)"
  )) %>% 
  
  tab_footnote(
    footnote = html("<sup>a</sup> Expected denominator is the PRiSMA cohort; observed denominator includes those with non-missing results.")
  ) %>%
  
  gtsave("CBC_Biomarkers.png", expand = 10)

knitr::include_graphics("CBC_Biomarkers.png")

```
## 2.9 Hemoglobin A1c Test
```{r}
matrix_demo_a <- data.temporal.wide %>% 
  group_by(SITE) %>% 
  summarise(
"Expected denominator, n^a^" = n(),
# HBA1C
"Observed denominator for HBA1C - Enrollment, n" = sum(!is.na(M08_HBA1C_LBORRES_1)),
"HBA1C - Enrollment: mean (SD)" = paste0(round(mean(M08_HBA1C_LBORRES_1, na.rm = TRUE), digits = 2), " (", format(sd(M08_HBA1C_LBORRES_1, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for HBA1C - ANC20, n" = sum(!is.na(M08_HBA1C_LBORRES_2)),
"HBA1C - ANC20: mean (SD)" = paste0(round(mean(M08_HBA1C_LBORRES_2, na.rm = TRUE), digits = 2), " (", format(sd(M08_HBA1C_LBORRES_2, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for HBA1C - ANC28, n" = sum(!is.na(M08_HBA1C_LBORRES_3)),
"HBA1C - ANC28: mean (SD)" = paste0(round(mean(M08_HBA1C_LBORRES_3, na.rm = TRUE), digits = 2), " (", format(sd(M08_HBA1C_LBORRES_3, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for HBA1C - ANC32, n" = sum(!is.na(M08_HBA1C_LBORRES_4)),
"HBA1C - ANC32: mean (SD)" = paste0(round(mean(M08_HBA1C_LBORRES_4, na.rm = TRUE), digits = 2), " (", format(sd(M08_HBA1C_LBORRES_4, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for HBA1C - ANC36, n" = sum(!is.na(M08_HBA1C_LBORRES_5)),
"HBA1C - ANC36: mean (SD)" = paste0(round(mean(M08_HBA1C_LBORRES_5, na.rm = TRUE), digits = 2), " (", format(sd(M08_HBA1C_LBORRES_5, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
     ) %>% 
  t() %>% as.data.frame() %>% 
  `colnames<-`(c(.[1,])) %>% 
  slice(-1) %>% 
  add_column(
    .after = 6,
    "Total" = data.temporal.wide %>% 
      summarise(
"Expected denominator, n^a^" = n(),
# HBA1C
"Observed denominator for HBA1C - Enrollment, n" = sum(!is.na(M08_HBA1C_LBORRES_1)),
"HBA1C - Enrollment: mean (SD)" = paste0(round(mean(M08_HBA1C_LBORRES_1, na.rm = TRUE), digits = 2), " (", format(sd(M08_HBA1C_LBORRES_1, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for HBA1C - ANC20, n" = sum(!is.na(M08_HBA1C_LBORRES_2)),
"HBA1C - ANC20: mean (SD)" = paste0(round(mean(M08_HBA1C_LBORRES_2, na.rm = TRUE), digits = 2), " (", format(sd(M08_HBA1C_LBORRES_2, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for HBA1C - ANC28, n" = sum(!is.na(M08_HBA1C_LBORRES_3)),
"HBA1C - ANC28: mean (SD)" = paste0(round(mean(M08_HBA1C_LBORRES_3, na.rm = TRUE), digits = 2), " (", format(sd(M08_HBA1C_LBORRES_3, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for HBA1C - ANC32, n" = sum(!is.na(M08_HBA1C_LBORRES_4)),
"HBA1C - ANC32: mean (SD)" = paste0(round(mean(M08_HBA1C_LBORRES_4, na.rm = TRUE), digits = 2), " (", format(sd(M08_HBA1C_LBORRES_4, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for HBA1C - ANC36, n" = sum(!is.na(M08_HBA1C_LBORRES_5)),
"HBA1C - ANC36: mean (SD)" = paste0(round(mean(M08_HBA1C_LBORRES_5, na.rm = TRUE), digits = 2), " (", format(sd(M08_HBA1C_LBORRES_5, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
    ) %>% 
      t() %>% unlist()
  )

tb_demo_a <- tb_theme1(matrix_demo_a) %>% 
  tab_header(
    title = md("**Table 2.9: Hemoglobin A1c Test**")
  ) %>% 
  tab_row_group(
    label = "Hemoglobin A1c (mmol/mol)",
    rows = 2:11
  ) %>% 
  # Bold observed denominator rows
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(rows = c(
      "Observed denominator for HBA1C - Enrollment, n",
      "Observed denominator for HBA1C - ANC20, n",
      "Observed denominator for HBA1C - ANC28, n",
      "Observed denominator for HBA1C - ANC32, n",
      "Observed denominator for HBA1C - ANC36, n"
    ))
  ) %>%

  row_group_order(groups = c(NA,
    "Hemoglobin A1c (mmol/mol)"
  )) %>% 
  
  tab_footnote(
    footnote = html("<sup>a</sup> Expected denominator is the PRiSMA cohort; observed denominator includes those with non-missing results.")
  ) %>%
  
  gtsave("HBA1C.png", expand = 10)

knitr::include_graphics("HBA1C.png")
```
## 2.10 Inflammation
```{r}
matrix_demo_a <- data.temporal.wide %>% 
  group_by(SITE) %>% 
  summarise(
"Expected denominator, n^a^" = n(),
# CRP
"Observed denominator for CRP - Enrollment, n" = sum(!is.na(M08_CRP_LBORRES_1)),
"CRP - Enrollment: mean (SD)" = paste0(round(mean(M08_CRP_LBORRES_1, na.rm = TRUE), digits = 2), " (", format(sd(M08_CRP_LBORRES_1, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for CRP - ANC20, n" = sum(!is.na(M08_CRP_LBORRES_2)),
"CRP - ANC20: mean (SD)" = paste0(round(mean(M08_CRP_LBORRES_2, na.rm = TRUE), digits = 2), " (", format(sd(M08_CRP_LBORRES_2, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for CRP - ANC28, n" = sum(!is.na(M08_CRP_LBORRES_3)),
"CRP - ANC28: mean (SD)" = paste0(round(mean(M08_CRP_LBORRES_3, na.rm = TRUE), digits = 2), " (", format(sd(M08_CRP_LBORRES_3, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for CRP - ANC32, n" = sum(!is.na(M08_CRP_LBORRES_4)),
"CRP - ANC32: mean (SD)" = paste0(round(mean(M08_CRP_LBORRES_4, na.rm = TRUE), digits = 2), " (", format(sd(M08_CRP_LBORRES_4, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for CRP - ANC36, n" = sum(!is.na(M08_CRP_LBORRES_5)),
"CRP - ANC36: mean (SD)" = paste0(round(mean(M08_CRP_LBORRES_5, na.rm = TRUE), digits = 2), " (", format(sd(M08_CRP_LBORRES_5, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
# AGP
"Observed denominator for AGP - Enrollment, n" = sum(!is.na(M08_AGP_LBORRES_1)),
"AGP - Enrollment: mean (SD)" = paste0(round(mean(M08_AGP_LBORRES_1, na.rm = TRUE), digits = 2), " (", format(sd(M08_AGP_LBORRES_1, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for AGP - ANC20, n" = sum(!is.na(M08_AGP_LBORRES_2)),
"AGP - ANC20: mean (SD)" = paste0(round(mean(M08_AGP_LBORRES_2, na.rm = TRUE), digits = 2), " (", format(sd(M08_AGP_LBORRES_2, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for AGP - ANC28, n" = sum(!is.na(M08_AGP_LBORRES_3)),
"AGP - ANC28: mean (SD)" = paste0(round(mean(M08_AGP_LBORRES_3, na.rm = TRUE), digits = 2), " (", format(sd(M08_AGP_LBORRES_3, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for AGP - ANC32, n" = sum(!is.na(M08_AGP_LBORRES_4)),
"AGP - ANC32: mean (SD)" = paste0(round(mean(M08_AGP_LBORRES_4, na.rm = TRUE), digits = 2), " (", format(sd(M08_AGP_LBORRES_4, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for AGP - ANC36, n" = sum(!is.na(M08_AGP_LBORRES_5)),
"AGP - ANC36: mean (SD)" = paste0(round(mean(M08_AGP_LBORRES_5, na.rm = TRUE), digits = 2), " (", format(sd(M08_AGP_LBORRES_5, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
     ) %>% 
  t() %>% as.data.frame() %>% 
  `colnames<-`(c(.[1,])) %>% 
  slice(-1) %>% 
  add_column(
    .after = 6,
    "Total" = data.temporal.wide %>% 
      summarise(
"Expected denominator, n^a^" = n(),
# CRP
"Observed denominator for CRP - Enrollment, n" = sum(!is.na(M08_CRP_LBORRES_1)),
"CRP - Enrollment: mean (SD)" = paste0(round(mean(M08_CRP_LBORRES_1, na.rm = TRUE), digits = 2), " (", format(sd(M08_CRP_LBORRES_1, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for CRP - ANC20, n" = sum(!is.na(M08_CRP_LBORRES_2)),
"CRP - ANC20: mean (SD)" = paste0(round(mean(M08_CRP_LBORRES_2, na.rm = TRUE), digits = 2), " (", format(sd(M08_CRP_LBORRES_2, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for CRP - ANC28, n" = sum(!is.na(M08_CRP_LBORRES_3)),
"CRP - ANC28: mean (SD)" = paste0(round(mean(M08_CRP_LBORRES_3, na.rm = TRUE), digits = 2), " (", format(sd(M08_CRP_LBORRES_3, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for CRP - ANC32, n" = sum(!is.na(M08_CRP_LBORRES_4)),
"CRP - ANC32: mean (SD)" = paste0(round(mean(M08_CRP_LBORRES_4, na.rm = TRUE), digits = 2), " (", format(sd(M08_CRP_LBORRES_4, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for CRP - ANC36, n" = sum(!is.na(M08_CRP_LBORRES_5)),
"CRP - ANC36: mean (SD)" = paste0(round(mean(M08_CRP_LBORRES_5, na.rm = TRUE), digits = 2), " (", format(sd(M08_CRP_LBORRES_5, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
# AGP
"Observed denominator for AGP - Enrollment, n" = sum(!is.na(M08_AGP_LBORRES_1)),
"AGP - Enrollment: mean (SD)" = paste0(round(mean(M08_AGP_LBORRES_1, na.rm = TRUE), digits = 2), " (", format(sd(M08_AGP_LBORRES_1, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for AGP - ANC20, n" = sum(!is.na(M08_AGP_LBORRES_2)),
"AGP - ANC20: mean (SD)" = paste0(round(mean(M08_AGP_LBORRES_2, na.rm = TRUE), digits = 2), " (", format(sd(M08_AGP_LBORRES_2, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for AGP - ANC28, n" = sum(!is.na(M08_AGP_LBORRES_3)),
"AGP - ANC28: mean (SD)" = paste0(round(mean(M08_AGP_LBORRES_3, na.rm = TRUE), digits = 2), " (", format(sd(M08_AGP_LBORRES_3, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for AGP - ANC32, n" = sum(!is.na(M08_AGP_LBORRES_4)),
"AGP - ANC32: mean (SD)" = paste0(round(mean(M08_AGP_LBORRES_4, na.rm = TRUE), digits = 2), " (", format(sd(M08_AGP_LBORRES_4, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
"Observed denominator for AGP - ANC36, n" = sum(!is.na(M08_AGP_LBORRES_5)),
"AGP - ANC36: mean (SD)" = paste0(round(mean(M08_AGP_LBORRES_5, na.rm = TRUE), digits = 2), " (", format(sd(M08_AGP_LBORRES_5, na.rm = TRUE), digits = 2, nsmall = 2), ")"),
    ) %>% 
      t() %>% unlist()
  )

tb_demo_a <- tb_theme1(matrix_demo_a) %>% 
  tab_header(
    title = md("**Table 2.10: Inflammation**")
  ) %>% 
  tab_row_group(
    label = "C-reactive protein (mg/L)",
    rows = 2:11
  ) %>% 
  tab_row_group(
    label = "Alpha 1-acid glycoprotein (g/L)",
    rows = 12:21
  ) %>% 

  # Bold observed denominator rows
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(rows = c(
      "Observed denominator for CRP - Enrollment, n",
      "Observed denominator for CRP - ANC20, n",
      "Observed denominator for CRP - ANC28, n",
      "Observed denominator for CRP - ANC32, n",
      "Observed denominator for CRP - ANC36, n",
      
      "Observed denominator for AGP - Enrollment, n",
      "Observed denominator for AGP - ANC20, n",
      "Observed denominator for AGP - ANC28, n",
      "Observed denominator for AGP - ANC32, n",
      "Observed denominator for AGP - ANC36, n"
    ))
  ) %>%

  row_group_order(groups = c(NA,
    "C-reactive protein (mg/L)", 
    "Alpha 1-acid glycoprotein (g/L)"
  )) %>% 
  
  tab_footnote(
    footnote = html("<sup>a</sup> Expected denominator is the PRiSMA cohort; observed denominator includes those with non-missing results.")
  ) %>%
  
  gtsave("Inflammation.png", expand = 10)

knitr::include_graphics("Inflammation.png")
```
